issuekey,created,title,description,storypoints
30087182,2020-01-29 23:19:58.696,Error reporting to VSCode OutputChannel,"### Problem to solve

In my experience today, there was very little information about what was working or not. The side pane simply stayed blank and did not show anything apart from the default text (""there is no XYZ assigned to you"" etc.). Which makes it very hard to understand at what point something goes wrong or what might be the cause (connection to GitLab? authentication? extension not configured correctly?).

### Proposal

Creating and logging to an OutputChannel (see https://code.visualstudio.com/api/references/vscode-api#window.createOutputChannel) instead of logging to console would probably make it easier for the user to understand what is happening (and what not).

### Further details

#### In scope

- bubble exceptions to the top-level client code (e.g. `extension.js`) and then log them to the output channel
- make sure that exceptions are not silenced (by empty try/catch blocks)
- **stretch**: separate exceptions from normal program flow - a lot of code in `git_service.js` and `gitlab_service.js` is using exceptions as a part of normal program flow (e.g. command returning empty result & command throwing exception is treated the same)
- making sure that the OutputChannel is shown during automated integratin tests (it will help understanding what's wrong)

#### Out of scope

- 

### Links / references

- https://code.visualstudio.com/api/references/vscode-api#window.createOutputChannel",3
26478886,2019-10-30 10:34:50.917,Insert Snippets in to current file in VS Code,"## Problem to Solve

Snippets inside of a user account must be copy/pasted out of GitLab and into a file when they need to be used in another place. This is error prone and time consuming to context switch and find the appropriate Snippet and then paste the contents in to the file you're working on.

## Proposal

Create a command for `Insert Snippet` that talks to the GitLab Snippets API to retrieve a list of Snippets and then choose which file to insert.

![image](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/30999d43156eb226d562c61c1d314611/Kapture_2020-09-11_at_11.53.01.gif)

- If a user selects insert snippet from the command palette, display a list of single file project scoped snippets in the modal
- If a user selects a snippet from the list insert it's content to the editor at the cursor position
<!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION -->
*This page may contain information related to upcoming products, features and functionality.
It is important to note that the information presented is for informational purposes only, so please do not rely on the information for purchasing or planning purposes.
Just like with all projects, the items mentioned on the page are subject to change or delay, and the development, release, and timing of any products, features, or functionality remain at the sole discretion of GitLab Inc.*
<!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION -->",3
21291743,2019-05-25 13:57:04.945,"API calls fail when the GitLab instance is on a custom path, but the git remote isn't","## Summary

The API calls are not working when the `gitlab.instanceUrl` setting contains a custom path, but the `git remote` URL doesn't.

Example:

```
""gitlab.instanceUrl"": ""http://aom-int/gitlab"",
```

and `git remote`:

```
git@aom-int:depoortere/testmaven.git
```

The parsing logic expects that if the `instanceUrl` contains a custom path, the `git remote` will too. From the example above: `http://aom-int/gitlab` `instanceUrl` should have `git@aom-int:gitlab/depoortere/testmaven.git` `git remote`.

### Details

The original issue with GitLab on a custom path is this: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/42

And the initial fix was implemented in https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/11.

[The implementation](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/56dab86117c109443a9422b85b58605fa5b774f1/src/git/git_remote_parser.ts#L30) assumes that if your GitLab instance is on a custom path (e.g. `/gitlab`) then the `git remote` URL contains the same path (i.e. in above scenario the remote should be `git@aom-int:gitlab/depoortere/testmaven.git`. I'm not sure whether that's a reasonable assumption or not, but it doesn't hold true in above scenario.

A workaround might be to use `https://` remote URL instead of the `git@..`. I assume that the `https://` version would have `/gitlab` in the remote path.

The code for parsing remotes is in [`git_remote_parser.ts`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/56dab86117c109443a9422b85b58605fa5b774f1/src/git/git_remote_parser.ts#L10-38). I'm open to suggestions about how to change it. I also include a failing test with above scenario:

<details>
<summary>Failing test case</summary>

```diff
diff --git a/src/git/git_remote_parser.test.ts b/src/git/git_remote_parser.test.ts
index 33cba5a..c3c4586 100644
--- a/src/git/git_remote_parser.test.ts
+++ b/src/git/git_remote_parser.test.ts
@@ -81,4 +81,14 @@ describe('git_remote_parser', () => {
       project: 'gitlab-vscode-extension',
     });
   });
+
+  it('should support host aliases with a custom path', () => {
+    expect(
+      parseGitRemote('git@aom-int:depoortere/testmaven.git', 'https://aom-int/gitlab'),
+    ).toEqual({
+      host: 'aom-int',
+      namespace: 'depoortere',
+      project: 'testmaven',
+    });
+  });
 });
```

</details>


<details>
<summary>Original issue description</summary>

Say my GITLAB instance URL is https://xyz.com/gitlab  (Exposed via Nginx)

In this case, the parsing by the extension is done incorrectly and fails to retrieve any information.

The parsed array gives this (removing /gitlab from the path):

[""http:"", ""xyz.com"", ""my-group/subgroup1"", ""project""]

And thus the extension does not work. I tried concatenating the extra ""/gitlab"" and still it does not work.

Meanwhile, what ports does this extension need/use? I only have https port of my instance exposed - have not exposed the SSH or git port.

</details>",1
16800932,2018-12-19 22:42:26.196,Matching access token URL with GitLab instance URL is too strict,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.

If you are facing issues around configuring Token from your GitLab.com account, see the list of already addressed Token related issues:

https://gitlab.com/gitlab-org/gitlab-vscode-extension/issues?scope=all&utf8=%E2%9C%93&state=closed&label_name[]=token-issue
--->

### Summary

The GitLab instance URL configured in `gitlab.instanceUrl` and the URL you specify when adding a new access token needs to match perfectly. If one contains slash at the end, the token is not used.

<details>
<summary>Original description</summary>

Connection issues with self-hosted GitLab instance URL name.

e.g. correct connection when `https://my.gitlabinstance.io/group-name/project1` as opposed to `https://my.gitlabinstance.io/group-name/project1/`

There are no instructions that mention to put it exactly like this...

</details>

### Steps to reproduce

1. open workspace with project on `gitlab.com`
1. remove your token with `GitLab: Remove your Personal Access Token` command
1. add the same token but specify `https://gitlab.com/` as the instance URL (notice the `/` at the end)
1. now the extension can't authenticate your requests and you see an error

### What is the current *bug* behavior?

The extension cant match the token for `https://gitlab.com/` with the configured instance `https://gitlab.com` (without the slash)

### What is the expected *correct* behavior?

The extension should be able to recognise that those two URLs are for the same GitLab instance and use the token

### Relevant logs and/or screenshots

![Screenshot_2020-07-24_at_1.23.50_PM](/uploads/eacc8e0190ed9b87a0e65104e5cad0d4/Screenshot_2020-07-24_at_1.23.50_PM.png)

### Possible fixes

A naive solution would be to remove trialling slashes. A more complete solution could be parsing the URLs and deciding what parts need to match (most likely hostname, and port, maybe protocol).",1
14680257,2018-10-04 10:53:18.349,"Auto update ""For Current Branch"" tab in sidebar","To improve the current behavior ""For Current Branch"" tab should auto update itself.

Also refreshing the panels should clear issue and MR cache. Related with this one https://gitlab.com/fatihacet/gitlab-vscode-extension/issues/21

## Problem

Rith now the sidebar with ""For Current Branch"" information needs to be manually refreshed and it will likely show outdated information.

Additionally, the status bar refreshes every 30s, but at the start of the VS Code, the first refresh happens before the extension can access the git repository and the user always sees roughly 25s of ""initializing status bar"":

![status bar](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/815e15090c1dc2566e48c75b8bcc1bc0/Screenshot_2021-09-07_at_20.10.54.png)

## Proposal

Both the ""For Current Branch"" sidebar panel and the status bar are using the same information (pipeline, MR, and issue). I suggest that they'll get automatically updated together. The update is going to be triggered by the following events:

- Repository has been initialized (fixes the initial 25s of delay)
- Branch has been changed
- 30 seconds have passed since the last update (only this is now partially implemented)",2
10763880,2018-05-10 14:47:44.457,Merge requests fail where branch contains a # symbol,"
### Summary

When we call `GitLab: Crete new merge request on current branch` command, branch with `#` doesn't get escaped causing incorrect branch name

### Steps to reproduce

1. Create `test-#-hash` branch and push a commit to the remote.
1. Run `GitLab: Crete new merge request on current branch` command

### What is the current *bug* behavior?

The branch name appears unescaped in the URL:

```
http://127.0.0.1:3000/root/empty-test-2/-/merge_requests/new?merge_request%5Bsource_branch%5D=test-#-hash
```

The `#-hash` gets treated as the browser ID fragment.

### What is the expected *correct* behavior?

The `#` is encoded and we open the MR with the following URL:

```
http://127.0.0.1:3000/root/empty-test-2/-/merge_requests/new?merge_request[source_branch]=test-%23-hash
```

### Relevant logs and/or screenshots

![Screenshot_2020-08-05_at_11.14.34_AM](/uploads/2631da4c7bea6a6e97901e44cd4ff374/Screenshot_2020-08-05_at_11.14.34_AM.png)

### Possible fixes

Probably calling `encodeURIComponent(branchName);` is enough to fix the issue.",1
117140277,2022-10-19 01:39:45.849,Add OAuth support for VSCodium,"When I click the `Connect to GitLab.com with OAuth` button I get a redirect error screen on GitLab's Web UI:

![image](/uploads/9b062930e8dad00ac522e49fd6c6a30b/image.png)

This is probably due to it being on VSCodium... so the redirect url includes: `vscodium` instead of `vscode`:

```
https://gitlab.com/oauth/authorize?client_id=...&redirect_uri=vscodium%3A%2F%2Fgitlab.gitlab-workflow%2Fauthentication&response_type=code&state=...&scope=api+read_user&code_challenge=...&code_challenge_method=S256
```

we likely need to add it as valid redirects",1
116769263,2022-10-12 17:23:38.888,Don't log the whole token,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.
--->

### Checklist

<!-- Please test the latest versions, that will remove the possibility that you see a bug that is fixed in a newer version. -->

- [ ] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: _Put your extension version here_
- [ ] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: _Put your VS Code version here_
- [ ] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: _Put your GitLab version here, or say ""happens on `gitlab.com`""_

### Summary

When user enables debug logging, we log the whole token in the extension output every time the OAuth token is refreshed (~2h). Ideally we would like not to log the whole access token.

https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/77a1cbc0f7d85dbab917d8c06203663bbc87b525/src/gitlab/token_exchange_service.ts#L111

### Steps to reproduce

<!-- How one can reproduce the issue - this is very important -->

### What is the current _bug_ behavior?

<!-- What actually happens -->

### What is the expected _correct_ behavior?

<!-- What you should see instead -->

### Relevant logs and/or screenshots

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`). Please enable `""gitlab.debug"": true` in your `settings.json`. Debug mode will improve error stack traces and adds debug log messages. -->

### Possible fixes

<!-- If you can, link to the line of code that might be responsible for the problem -->",3
112169745,2022-07-25 17:22:56.460,Custom Query error with `avatar_url` in Vulnerabilty Reports,"## Problem to Solve

When using a custom query to look at vulnerability reports, there is an issue with `avatar_url` being expected in the response:

**Error Message:**
```
[error]: Cannot read properties of undefined (reading 'avatar_url')
         TypeError: Cannot read properties of undefined (reading 'avatar_url')
         	at /Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.47.2/out/extension.js:298:239
         	at Array.map (<anonymous>)
         	at Js.getIssuables (/Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.47.2/out/extension.js:327:3252)
         	at processTicksAndRejections (node:internal/process/task_queues:96:5)
         	at async bd.getProjectIssues (/Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.47.2/out/extension.js:344:2214)
         	at async bd.getChildren (/Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.47.2/out/extension.js:344:2963)
         	at async v.fetchChildrenNodes (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/api/node/extensionHostProcess.js:106:19736)
         	at async v.getChildren (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/api/node/extensionHostProcess.js:106:15955)

```

**Custom Query:**
```
""gitlab.customQueries"": [
        {
        ""name"": ""Vulnerability Reports"",
        ""type"": ""vulnerabilities"",
        ""scope"": ""all"",
        ""noItemText"": ""No Vulns."",
        ""state"": ""opened""
        }
    ] 
```

This was tested against the `gitlab-org/gitlab` project.",1
109854568,2022-06-09 13:27:08.070,Update development documentation,"### Problem to solve

The development documentation hasn't been updated in about a year. We plan to add more team members as maintainers soon. That means we need the development documentation up to date.

### Proposal

Review the following documents:

- [x] CONTRIBUTING.md
- [x] docs/developer/architecture.md
- [x] docs/developer/ci-variables.md
- [x] docs/developer/coding-guidelines.md
- [x] docs/developer/commits.md
- [x] docs/developer/developer-process.md
- [x] docs/developer/maintainer.md
- [x] docs/developer/release-process.md
- [x] docs/developer/security-releases.md
- [x] docs/developer/testing-strategy.md
- [x] docs/developer/writing-tests.md


### Links / references",1
108685441,2022-05-17 13:51:27.785,PAT no longer available after restart,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.
--->

### Checklist

<!-- Please test the latest versions, that will remove the possibility that you see a bug that is fixed in a newer version. -->

- [x] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: v3.44.1
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: 1.67.1
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: 14.9.1

### Summary

Initial installation of the plugin works well after the PAT and URL are set up.

After shutdown of VSCode and restart the PAT seems to be unavailable.

I'm not sure how to debug any further.

### Steps to reproduce

1. Start with a linux desktop environment.  In this case Archlinux with SwayWM.
2. Launch VSCode, install the plugin, and configure it with a URL and PAT.
3. Observe all works well.
4. Exit VSCode and re-launch.
5. Observe that the extension no longer is authenticated
6. Attempt to provide the URL and a new PAT, but it never succeeds.

### What is the current _bug_ behavior?

Plugin no longer works.

### What is the expected _correct_ behavior?

1. That the PAT is retained for next launch
2. That the plugin continues to work after re-launch

### Relevant logs and/or screenshots

```
[error]: Account for instance REDACTED and user REDACTED is missing token in secret storage. Try to remove the account and add it again.
```

### Possible fixes

<!-- If you can, link to the line of code that might be responsible for the problem -->",2
108130012,2022-05-06 07:58:14.149,MR Review comments are not rendering Markdown,"### Checklist

<!-- Please test the latest versions, that will remove the possibility that you see a bug that is fixed in a newer version. -->

- [x] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: `3.43.1`
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: `1.67.0-insider`
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: ""happens on `gitlab.com`""

### Summary

Markdown in MR comments stopped rendering in the newer version of VS Code

![gitlab-vscode-extension](/uploads/0096dfa1ad3ae66b41f819f5abb5e238/gitlab-vscode-extension.png)

GitLab Workflow depended on a ""bug"" in VS Code. VS Code rendered plain text comment body as markdown ([Comment.body rendered as Markdown, even for plain strings · Issue #140967 · microsoft/vscode](https://github.com/microsoft/vscode/issues/140967)). They fixed it in February 2022 and since then we show plain text MR comments.

### Steps to reproduce

1. See any MR comment with Markdown syntax.

### What is the current _bug_ behavior?

Markdown is shown as plain string.

### What is the expected _correct_ behavior?

Markdown should be rendered.

![_Extension_Development_Host__-_gitlab-vscode-extension-TEST](/uploads/e875bc21fe466c6210a51ff67691e998/_Extension_Development_Host__-_gitlab-vscode-extension-TEST.png)

### Relevant logs and/or screenshots

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->

### Possible fixes

Use `vscode.MarkdownString` rather than `string` for the MR body.",1
107015529,2022-04-22 08:08:31.388,Advanced search is broken + minor errors in issuable search,"### Summary

The extension has a rudimentary search feature (it shows you input box and then it opens the web search results for you).

There are 3 commands: 

-  `GitLab: Search Project Issues (Supports Filters)`
- `GitLab: Search Project Merge Requests (Supports Filters)`
- `GitLab: Project Advanced Search (Issues, MR's, Commits, Comments...)`

The advanced project search doesn't work. The remaining searches are sometimes throwing errors (no user-facing defects though).

### Steps to reproduce

1. Open GitLab project in VS Code
2. run the `GitLab: Project Advanced Search (Issues, MR's, Commits, Comments...)`
3. type in any query that would normally return results
4. see that the search results are empty

### What is the current _bug_ behavior?

The extension creates URL with `project_id=undefined` in it and the search results are empty.

### What is the expected _correct_ behavior?

The extension creates correct URL and there are search results.

### Relevant logs and/or screenshots

![dependency___Search___GitLab](/uploads/f481536c1f1d678b351622e2f2199ebd/dependency___Search___GitLab.png)

### Possible fixes

We use `project.id` in `search_input.js`, we should use `project.restId`. Best solution is to migrate this small file to TS, which would discover such an issue.",1
106325001,2022-04-08 11:38:31.872,Implement OAuth token refreshing,"

### Problem to solve

When we generate an access token using the OAuth flow (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/560), the token will expire (by default in 2 hours). 

### Proposal

Ask for a new token using the `refresh_token` https://docs.gitlab.com/ee/api/oauth2.html#authorization-code-with-proof-key-for-code-exchange-pkce.

### Further details

We'll need to keep track of when the original token has been generated and refresh it when the extension want's to use it after its expiration time.

### Links / references",2
106324564,2022-04-08 11:27:06.847,Implement OAuth flow for `gitlab.com`,"### Problem to solve

Users have to [log in with generated personal access token](https://gitlab.com/gitlab-org/gitlab-vscode-extension#setup).

### Proposal

Allow OAuth authorization so user's can log in to `gitlab.com` without generating token.

### Further details

https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/221#note_885722819

### Links / references",2
106032596,2022-04-04 13:05:49.059,Project-centric data model - change extension model to reflect Git and GitLab models,"### Problem to solve

There are many edge cases when the extension's internal state can't reflect how entities (git remotes and GitLab projects) relate to each other. This is caused by the incremental nature of the current model design.

1. We started with workspace centric approach, where the whole extension operated on an opened folder. This implementation couldn't support multiple repositories.
1. We refactored the extension to use repositories instead of workspaces (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/345). This was a large improvement, but the model still struggles to reflect some scenarios. It especially struggles with multiple remotes and repositories that don't contain GitLab projects.

The way how repository-centred approach doesn't exactly reflect the Git repository + GitLab project entities is a cause of small bugs and misunderstandings. Currently, we [mix repository and project-related methods](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/d92a0cb3cfa47d5cc7dcf074edd21a6220bb8870/src/git/wrapped_repository.ts#L71).

### Proposal

In hindsight, the solution is clear: Use the GitLabProject-centric approach. As the extension starts or configuration changes, we'll loop over all remote URLs in all repositories and find out which ones correspond to GitLab projects. Then, if there's more than one GitLab project per repository, we'll let the user choose which one they want to use.

### Benefits

- Simpler logic, many places in the codebase are now concerned about how to obtain GitLabProject from a repository. There is often an implicit expectation that the project is present.
- Simpler mental model - a few entities will reflect the whole application state, clear separation between the GitLab project model and the local repository model
- Easy support for [multiple accounts](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/298), which will become more important once we implement [OAuth login](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/221)

### Further details

Here are a few issues that we implemented to work around the repository-centric model:

- [Helping users set the correct remote name](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/459)
- [Unable to Validate CI config for mirrored repository](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/505)
- [Extension ignores expired token and fails in the wrong place](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/487)

### Proposed model

I'll put this in a diagram a bit later:

```ts

interface Repository {
  remotes: Remote[]
  // all local repository git methods will be here
}

interface Remote {
  name: string;
  urlEntries: UrlEntry[];
}

interface UrlEntry {
  type: 'fetch' | 'push' | 'both';
  url: string;
}

/* This pointer allows us to work with remote URLs (because they represent GitLab Project),
 * but also keep track of what local repository contains this remote URL.
*/
interface RemoteUrlPointer {
  repository: Repository;
  remote: Remote;
  urlEntry: UrlEntry;
}

interface Account {
  instanceUrl: string;
  token: string;
}

/* Represents a GitLab project that we can infer from remote URL and instance URL */
interface ParsedProject {
  remoteUrl: string;
  instanceUrl: string;
  projectName: string;
  namespace: string;
}

/* In a case when there is more than one GitLab project in a repository,
 * the user will create this setting to indicate which project should be used.
 * This will be a persistent setting stored in the global storage.
 *
 * There can be more than one GitLab project for a repository if there are multiple
 * remotes like:
 *
 * - git@gitlab.com:gitlab-org/gitlab-vscode-extension.git
 * - git@gitlab.com:gitlab-org/security/gitlab-vscode-extension.git
 *
 * Or when there are multiple accounts on the same GitLab instance.
 */
interface SelectedProject {
  pointer: RemoteUrlPointer;
  account: Account;
  projectName: string;
  namespace: string;
}

/* This represents a GitLab project that the rest of the extension will work with
 * this entity only exists at runtime, and the `GitLabProject` is always populated by querying a GitLab API
 */
interface InitializedProject {
  project: GitLabProject;
  pointer: RemoteUrlPointer;
  account: Account;
  // all GitLab project methods are going to be either here or accessed through here
}

```

### Links / references",3
105059947,2022-03-18 10:01:54.691,Failed to fetch jobs for pipeline (for current branch) - project_id in the requested url is 'undefined',"### Checklist

- [x] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: v3.41.2 (v3.39.0 also has the same issue)
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: 1.65.2
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: 13.5.4-ee

### Summary

<!-- Summarize the bug encountered concisely -->

### Steps to reproduce

1. Install this extension
2. Setup gitlab.instanceUrl and personal access token
3. Open an VSCode workspace hosted by gitlab 13.5.4-ee
4. Click the gitlab icon in the sidebar, the pipeline result `FORCURRENT BRANCH` does not show fully: it shows the overall status but details are not displayed

### What is the current _bug_ behavior?

Can't see details of pipeline (see picture below)

### What is the expected _correct_ behavior?

Show details of pipeline correctly

### Relevant logs and/or screenshots

Logs from `GitLab: Show extension logs`
```
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async An.clearAndSetIntervalAndRefresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7866)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async An.clearAndSetIntervalAndRefresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7866)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7745)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async gl.refreshSidebar (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:317:2934)"",
             ""\tat async c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:317:1540"",
             ""\tat async r._executeContributedCommand (c:\\Apps\\VS Code\\resources\\app\\out\\vs\\workbench\\services\\extensions\\node\\extensionHostProcess.js:95:31072)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
[error]: {
           ""userMessage"": ""Failed to fetch jobs for pipeline."",
           ""errorMessage"": ""Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
           ""stack"": [
             ""Error: Fetching jobs for pipeline from https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs failed"",
             ""\tat ps (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:444)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)"",
             ""\tat async pa.fetch (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:265:1606)"",
             ""\tat async zv (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:7053)"",
             ""\tat async Function.getState (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8530)"",
             ""\tat async An.refresh (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8142)"",
             ""\tat async Timeout._onTimeout (c:\\Apps\\VS Code\\data\\extensions\\gitlab.gitlab-workflow-3.41.2\\out\\extension.js:316:8015)""
           ]
         }
```

(Note: I use a portable VS Code to re-produce this issue without any other extensions installed, but the issue also exists in a normal user setup of VS Code)

### Possible fixes

The problem might be caused by failure when get project id: in the log, you can see `undefined` in the request url, where it should be a project id:

`https://gitlab.ourcompany.com/api/v4/projects/undefined/pipelines/397251/jobs`

I try to replace regex `\{\w+\.project_id\}` with my project id `438` in `C:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.2`, then it works (see the picture below):

![gitlab_pipeline_error](/uploads/f450aa066c95a580ec26ba1c625c0359/gitlab_pipeline_error.png)",1
104749501,2022-03-14 08:17:12.947,Fail to access merge request and pipeline result - Field 'url' doesn't exist on type 'Note',"### Checklist

<!-- Please test the latest versions, that will remove the possibility that you see a bug that is fixed in a newer version. -->

- [x] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: v3.41.1
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: 1.65.2 (user setup)
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: 13.5.4-ee

### Summary



### Steps to reproduce

1. Install this extension
2. Setup gitlab.instanceUrl and personal access token
3. Open an VSCode workspace hosted by gitlab EE
4. Click the gitlab icon in the sidebar, it shows list of the merge requests
   (But here, the pipeline result FORCURRENT BRANCH does not show fully)
5. Click any MR in the ISSUES AND MERGE REQUESTS, an error message displays:
```
The extension failed to preload discussions on the MR diff.
            It's possible that you've encountered
            https://gitlab.com/gitlab-org/gitlab/-/issues/298827.
```
  (I tried to find a solution from above URL but not found)

6. Click 'Overview' of a MR, another error message displays:
```
Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""729""}}}
```
### What is the current _bug_ behavior?

Can't open the merge request

### What is the expected _correct_ behavior?

It should open the MR correctly

<!-- What you should see instead -->

### Relevant logs and/or screenshots
![gitlab_error](/uploads/e8a2c12d0a9b5a5183e1d5b7ae2cacbf/gitlab_error.png)
log from 'GitLab: Show extension logs'
```
[error]: {
           ""userMessage"": ""The extension failed to preload discussions on the MR diff.\n            It's possible that you've encountered\n            https://gitlab.com/gitlab-org/gitlab/-/issues/298827."",
           ""errorMessage"": ""Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""731\""}}}"",
           ""stack"": [
             ""Error: Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""731\""}}}"",
             ""\tat c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:15173"",
             ""\tat o (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:10042)"",
             ""\tat Object.next (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:9346)"",
             ""\tat p (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:8906)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)""
           ]
         }
[error]: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""731""}}}
         Error: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""731""}}}
         	at c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:15173
         	at o (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:10042)
         	at Object.next (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:9346)
         	at p (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:8906)
         	at processTicksAndRejections (internal/process/task_queues.js:93:5)
[error]: {
           ""userMessage"": ""The extension failed to preload discussions on the MR diff.\n            It's possible that you've encountered\n            https://gitlab.com/gitlab-org/gitlab/-/issues/298827."",
           ""errorMessage"": ""Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""730\""}}}"",
           ""stack"": [
             ""Error: Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""730\""}}}"",
             ""\tat c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:15173"",
             ""\tat o (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:10042)"",
             ""\tat Object.next (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:9346)"",
             ""\tat p (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:8906)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)""
           ]
         }
[error]: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""730""}}}
         Error: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""730""}}}
         	at c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:15173
         	at o (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:10042)
         	at Object.next (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:9346)
         	at p (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:8906)
         	at runMicrotasks (<anonymous>)
         	at processTicksAndRejections (internal/process/task_queues.js:93:5)
[error]: {
           ""userMessage"": ""The extension failed to preload discussions on the MR diff.\n            It's possible that you've encountered\n            https://gitlab.com/gitlab-org/gitlab/-/issues/298827."",
           ""errorMessage"": ""Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""729\""}}}"",
           ""stack"": [
             ""Error: Field 'url' doesn't exist on type 'Note': {\""response\"":{\""errors\"":[{\""message\"":\""Field 'url' doesn't exist on type 'Note'\"",\""locations\"":[{\""line\"":35,\""column\"":5}],\""path\"":[\""fragment noteDetails\"",\""url\""],\""extensions\"":{\""code\"":\""undefinedField\"",\""typeName\"":\""Note\"",\""fieldName\"":\""url\""}}],\""status\"":200,\""headers\"":{}},\""request\"":{\""query\"":\""\\n  \\n  \\n  \\n  \\n  fragment position on Note {\\n    position {\\n      diffRefs {\\n        baseSha\\n        headSha\\n        startSha\\n      }\\n      filePath\\n      positionType\\n      newLine\\n      oldLine\\n      newPath\\n      oldPath\\n      positionType\\n    }\\n  }\\n\\n  fragment noteDetails on Note {\\n    id\\n    createdAt\\n    system\\n    author {\\n      avatarUrl\\n      name\\n      username\\n      webUrl\\n    }\\n    body\\n    bodyHtml\\n    url\\n    userPermissions {\\n      resolveNote\\n      adminNote\\n      createNote\\n    }\\n    ...position\\n  }\\n\\n  fragment discussionDetails on Discussion {\\n    replyId\\n    createdAt\\n    resolved\\n    resolvable\\n    notes {\\n      pageInfo {\\n        hasNextPage\\n        endCursor\\n      }\\n      nodes {\\n        ...noteDetails\\n      }\\n    }\\n  }\\n\\n  fragment discussions on DiscussionConnection {\\n    pageInfo {\\n      hasNextPage\\n      endCursor\\n    }\\n    nodes {\\n      ...discussionDetails\\n    }\\n  }\\n\\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\\n    project(fullPath: $projectPath) {\\n      id\\n      mergeRequest(iid: $iid) {\\n        discussions(after: $afterCursor) {\\n          ...discussions\\n        }\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""dev/ProjectName\"",\""iid\"":\""729\""}}}"",
             ""\tat c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:15173"",
             ""\tat o (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:10042)"",
             ""\tat Object.next (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:9346)"",
             ""\tat p (c:\\Users\\username\\.vscode\\extensions\\gitlab.gitlab-workflow-3.41.1\\out\\extension.js:31:8906)"",
             ""\tat runMicrotasks (<anonymous>)"",
             ""\tat processTicksAndRejections (internal/process/task_queues.js:93:5)""
           ]
         }
[error]: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""729""}}}
         Error: Field 'url' doesn't exist on type 'Note': {""response"":{""errors"":[{""message"":""Field 'url' doesn't exist on type 'Note'"",""locations"":[{""line"":35,""column"":5}],""path"":[""fragment noteDetails"",""url""],""extensions"":{""code"":""undefinedField"",""typeName"":""Note"",""fieldName"":""url""}}],""status"":200,""headers"":{}},""request"":{""query"":""\n  \n  \n  \n  \n  fragment position on Note {\n    position {\n      diffRefs {\n        baseSha\n        headSha\n        startSha\n      }\n      filePath\n      positionType\n      newLine\n      oldLine\n      newPath\n      oldPath\n      positionType\n    }\n  }\n\n  fragment noteDetails on Note {\n    id\n    createdAt\n    system\n    author {\n      avatarUrl\n      name\n      username\n      webUrl\n    }\n    body\n    bodyHtml\n    url\n    userPermissions {\n      resolveNote\n      adminNote\n      createNote\n    }\n    ...position\n  }\n\n  fragment discussionDetails on Discussion {\n    replyId\n    createdAt\n    resolved\n    resolvable\n    notes {\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n      nodes {\n        ...noteDetails\n      }\n    }\n  }\n\n  fragment discussions on DiscussionConnection {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      ...discussionDetails\n    }\n  }\n\n  query GetMrDiscussions($projectPath: ID!, $iid: String!, $afterCursor: String) {\n    project(fullPath: $projectPath) {\n      id\n      mergeRequest(iid: $iid) {\n        discussions(after: $afterCursor) {\n          ...discussions\n        }\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""dev/ProjectName"",""iid"":""729""}}}
         	at c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:15173
         	at o (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:10042)
         	at Object.next (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:9346)
         	at p (c:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1\out\extension.js:31:8906)
         	at runMicrotasks (<anonymous>)
         	at processTicksAndRejections (internal/process/task_queues.js:93:5)

```
<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->

### Possible fixes

It seems that the extension failed to parse the project id correctly. I try to open `C:\Users\username\.vscode\extensions\gitlab.gitlab-workflow-3.41.1` and replace regex `\$\{\w+\.project_id\}` with my project id `438`, then I can see the pipeline result correctly, but the merge requests still can't be opened.
<!-- If you can, link to the line of code that might be responsible for the problem -->",1
103967604,2022-03-02 12:28:05.948,Fix /merge quick action by submitting head SHA with the new note,"
### Summary

The `/merge` quick action in any MR comment causes the API to fail. Original issue: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/352

![merge-quick-action](/uploads/27f47835194fa6553869733be9523f91/merge-quick-action.mp4)

### Steps to reproduce

Try to send a comment on an open MR that contains the `/merge` quick action.

### What is the current _bug_ behavior?

GitLab API fails with 500 error.

### What is the expected _correct_ behavior?

The MR gets merged.

### Relevant logs and/or screenshots

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->

### Possible fixes

We need to submit the `CreateNoteInput.mergeRequestDiffHeadSha` parameter to the GraphQL `createNote` mutation. This parameter should contain the MR HEAD SHA and it is used for optimistic locking.

Maybe we'll need to add a condition and only submit the parameter if the GitLab version is 14.9 or higher. I'm not 100% sure how GraphQL handles input parameters that are not defined (because the `mergeRequestDiffHeadSha` parameter won't be defined on older versions)",1
103884289,2022-03-01 10:51:05.632,POC - OAuth GitLab login in addition to token login,"### Problem to solve

The current way of generating Personal Access token and adding it to the extension is relatively complicated and prone to errors. More information is in the original issue https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/221

### Proposal

In the proof of concept we would test the OAuth login locally:

1. Create an [instance-wide OAuth application](https://docs.gitlab.com/ee/integration/oauth_provider.html#instance-wide-applications) in the local GDK
1. Create a page that GitLab redirects to when user gives the OAuth permission
    - Try localhost server triggered by the extension (this is how JetBrains GitHub plugin does it)
    - If that doesn't work, we can try to use GitLab Pages (that's similar to how the VS Code GitHub extension does it)
1. Implement the OAuth flow in the extension

### Further details

This is going to be proof-of-concept with throwaway code. The output is going to be:

- POC code in the extension
- Documentation on how to set up the OAuth application in the GitLab instance.
- It would be good to think how could this OAuth flow be adjusted for alternative VS Code deployments (Gitpod or `vscode.dev`) but that might be out of scope for this quick spike.

### Links / references",2
101152837,2022-01-24 14:19:44.538,Reintroduce minimal GitLab version warning,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

There are currently two version-related checks that could cut down on our triage/support time:

* [The README note](https://gitlab.com/gitlab-org/gitlab-vscode-extension#minimum-supported-version) - I have doubts that many people would install the extension, read this part of readme and double-check their GitLab instance version.
* [The Bug.md issue template](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/.gitlab/issue_templates/Bug.md) - From my experience maybe 20% of bug reports use that template, the rest is people clicking ""New Issue"" and describing their problem in the description.
  * I sometimes follow up and ask the issue creator to double-check their version but not always

The checks that we have in place are (IMO) not successful at letting people know they are using an unsupported GitLab version (unless they use the two features specified in [feat: remove minimal version requirement in favour of per-feature checking](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/342)).

### Proposal

Reintroduce the minimal version check that we removed in https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/342

Set the minimum supported version to 13.0

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

### Links / references",1
100379393,2022-01-10 17:33:00.840,No pipeline nor MR found for current branch,"### Summary

I have been using the extension smoothly for many month but a few days ago it stopped properly linking the remote branch MRs and Pipelines. When I am on master/main it still works, but as soon as I switch to any other branch it stops showing the latest MR and pipeline status in the bottom bar. In the extension sidebar is stills shows the project merge requests though... I have uninstall and re-install, but this did not fix the issue.

![image](/uploads/735c95a3d496e5a4e0d0d181ddb74feb/image.png)  

### Steps to reproduce

See above

### Relevant logs and/or screenshots

Nothing particularly suspicious in the logs:
```
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
[info]: Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
```",1
98682076,2021-12-08 16:32:01.060,Validate personal access token right after the user added it,"### Problem to solve

Users can add a personal access token that is invalid or expired, or they make a typo when entering the instance URL.

The extension will save this potentially incorrect pair (instance URL, token) and the user will find about the invalid token later when they try to use some of the extension functionality

### Proposal

Validate the token instantly after the user adds it. We can do that by calling `instanceUrl/api/v4/version` API endpoint.

### Further details

Thanks @pslaughter for suggesting this ~""type::feature"" 

### Links / references",1
98158818,2021-11-30 09:19:39.223,Remote repositories not showing all files,"

### Checklist

<!-- Please test the latest versions, that will remove the possibility that you see a bug that is fixed in a newer version. -->

- [x] I'm using the latest version of the extension ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: 3.38.1
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version: Latest insiders
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: happens on `gitlab.com`

### Summary

The extension loads a maximum of 20 files in the folder, if the folder has got more files/folders than that, the remote repository won't show them.

| local repository | remote repository |
| ------ | ------ |
| ![image](/uploads/733d37a1fb933a419b18c9fec9444e50/image.png) | ![image](/uploads/746bbc525e2606ce3133d908404d65b1/image.png) |


### Steps to reproduce

Open https://gitlab.com/gitlab-org/gitlab-vscode-extension as a remote repository, then open the `src/` folder.

### What is the current *bug* behavior?

The `src` folder has only 20 files.

### What is the expected *correct* behavior?

The `src` folder shows all the files


### Possible fixes

We need to make sure we load all pages if the REST API result is paginated",1
97260473,2021-11-12 19:20:44.596,Feature Request: Pipeline view does not show stages containing manually triggered jobs,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->  There is no issue with a ""feature"" label as of submission time

### Problem to solve

As a developer using this feature to monitor pipelines for the projects I work on, some of the pipelines contain stages containing [manual jobs](https://docs.gitlab.com/ee/ci/jobs/job_control.html#create-a-job-that-must-be-run-manually).  In the pipeline view for the extension, I do not see these stages nor can I manually trigger any of these jobs despite the stage containing these manual jobs also containing non-manual jobs.  Being able to view and trigger these jobs would allow for me to do more pipeline management from within VS code without having to use the web API.

### Proposal

Extend the pipeline view to include viewing manual jobs and the ability to trigger them.

### Further details


### Links / references",2
96370440,2021-10-29 04:45:32.256,Extension ignores expired token and fails in the wrong place,"Original title: (*Open Active File on GitLab fails with Cannot read property 'webUrl' of null*)

### Checklist

- [x] I'm using the latest version of the extension 3.34.0 ([see the latest version in the right column of this page](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - Extension version: *Put your extension version here*
- [x] I'm using the latest VS Code version ([find the latest version here](https://github.com/microsoft/vscode/releases))
  - VS Code version:
Version: 1.61.2
Commit: 6cba118ac49a1b88332f312a8f67186f7f3c1643
Date: 2021-10-19T15:49:28.381Z
Electron: 13.5.1
Chrome: 91.0.4472.164
Node.js: 14.16.0
V8: 9.1.269.39-electron.0
OS: Darwin x64 20.6.0
- [x] I'm using a supported version of GitLab ([see README for the supported version](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/README.md#minimum-supported-version))
  - GitLab version: 14.4.0-ee
### Summary

When I use the ""Open Active File on GitLab"" fails with Cannot read property 'webUrl' of null

### Steps to reproduce

Use an expired token to set up the extension.

Open any file and execute the ""Open Active File on GitLab"" command.

### What is the current *bug* behavior?

Nothing happens. No error, no browser window opened.

Before I updated it used to give this error:

```
Cannot read property 'webUrl' of null
TypeError: Cannot read property 'webUrl' of null
at getActiveFile (/Users/myusername/.vscode/extensions/gitlab.gitlab-workflow-3.33.0/out/src/openers.js:91:39)
at processTicksAndRejections (internal/process/task_queues.js:93:5)
at async openActiveFile (/Users/myusername/.vscode/extensions/gitlab.gitlab-workflow-3.33.0/out/src/openers.js:103:33)
at async /Users/myusername/.vscode/extensions/gitlab.gitlab-workflow-3.33.0/out/src/extension.js:36:9
at async _executeContributedCommand (/Applications/Visual Studio Code.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:94:110871)
```

### What is the expected *correct* behavior?

It should open a browser window with the file I selected.

### Relevant logs and/or screenshots

It looks like my logs are empty.",1
96137280,2021-10-26 07:16:33.326,Validate that instance URL starts with protocol,"### Problem to solve

Currently, users can add GitLab instance URLs that do not start with the protocol. This can happen in both the `gitlab.instanceUrl` setting and the instance URL specified when adding token.

This sometimes makes extension setup more confusing (e.g. #481).


### Proposal

When the user adds a token, validate that the instance URL starts with a protocol (either `http://` or `https://`).

When the extension notices a `gitlab.instanceUrl` setting, it warns user if the setting doesn't start with a protocol.

### Further details

This would work well with https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/515


### Links / references",1
95823326,2021-10-20 20:52:38.144,request: support vscode browser based extension (vscode.dev),"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

<!-- What problem do we solve? Try to define the who/what/why of the opportunity as a user story. For example, ""As a (who), I want (what), so I can (why/value)."" -->

As a developer I want to open my web browser to https://vscode.dev/gitlab.mycorp.com/mygroup/myproject/-/merge_requests/3 and to be able to see the code/MR, so I can use vscode just by clicking a link

### Proposal

<!-- How are we going to solve the problem? -->

potentially make the extension support web extensions, at least partially 

https://code.visualstudio.com/api/extension-guides/web-extensions#update-existing-extensions-to-web-extensions

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

If I have a lot of projects and merge requests get created, I'd rather be able to click a link to open an editor than open the editor, clone the repo, etc

[remote-fs-url-format.md](docs/user/remote-fs-url-format.md) is cool, but can't seem to open up a merge request or use the plugin from that view

`code --folder-uri 'gitlab-remote://gitlab.mycorp.com/myproject?project=35595&ref=master'`

### Links / references",2
95722138,2021-10-19 20:29:04.103,Pipeline status term mismatch: Succeeded,"## :speech_balloon: Term mismatch

The VSCode extension uses the term **Succeeded** for pipelines and jobs that finished without errors or warnings (green check mark) in the sidebar. The extension also uses **Passed** for pipelines in the bottom status bar. Meanwhile, the GitLab platform just uses the term **Passed** (except for [MWPS](https://docs.gitlab.com/ee/user/project/merge_requests/merge_when_pipeline_succeeds.html#merge-when-pipeline-succeeds)).

| Current (extension) | [Reference](https://gitlab.com/KevSlashNull/empty-brackets-in-extension/-/pipelines/391382511) (in GitLab) | Expected (extension) |
| --- | --- | --- |
| ![image](/uploads/2f8faaee6f2cdda63eab1c63c278752a/image.png) | ![image](/uploads/2393c667199e5a3c4a8248232e585396/image.png) | ![image](/uploads/76257b292c3cbfec6bb641cabceb11f5/image.png) |

| Status bar term |
| --- |
| ![image](/uploads/77ddf0e8b3f738dcd2938e147a6dfe3c/image.png) |

## :bulb: Proposal

Use the term **Passed** in the extension to be consistent with the UI text in the GitLab platform.",1
95016920,2021-10-07 08:24:27.920,flaky test: Pipeline actions - creates  new pipeline,"The test failed on master https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/jobs/1657306279, rerun fixed the pipeline.

Failed assertion: https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/400425fb1819824b3455f8fce3c1ccb96f6bbe68/test/integration/pipeline_actions.test.js#L51

I assume that the new refreshing logic introduced in #60 refreshes more than once and the `calledOnce` assumption fails.",1
92911576,2021-09-01 07:22:25.832,Helping users set the correct remote name,"### Problem to solve

Currently, when user has got multiple remotes in the same repository (e.g. `origin` and `upstream`) the GitLab Workflow extension silently selects the (alphabetically) first one (`origin` in this example).

Users can select remote to be used by setting the `gitlab.remoteName` (https://gitlab.com/gitlab-org/gitlab-vscode-extension#extension-settings). But that is not obvious to the user.

### Proposal

When we detect multiple remotes in the repository, we'll ask user which one they want to use and store it into the workspace settings (`gitlab.remoteName`)

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

### Links / references

- more context https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/433#note_662047082",2
92803258,2021-08-30 14:31:02.178,Can't access Issue detail from self-hosted gitlab (`Cannot read property 'full' of undefined`),"### Checklist

- [X] I'm using the latest version of the extension
  - Extension version: *v3.29.1*
- [X] I'm using the latest VS Code version
  - VS Code version: *1.51.1*
- [X] I'm using a supported version of GitLab
  - GitLab version: *14.2.1*

### Summary

I can see the list of issues associated with the current branch ![image](/uploads/2b208ecc8d687dbd0b2c778b1b236689/image.png)

But when I click on one of those issue they just display ""Fetching issuable details and discussions. This may take a while.""

This bug is similar to (#297) but the error message is different.

### Steps to reproduce
 - open VS Code
 - go to the GitLab Workflow tab
 - click on on of the issues associated with the current branch

### What is the current *bug* behavior?

It opens a tab with only ""Fetching issuable details and discussions. This may take a while.""

### What is the expected *correct* behavior?

To see the same thing that if I access the issue through ""Issues created by me""

### Relevant logs and/or screenshots

The logs gives:
```
Cannot read property 'full' of undefined
TypeError: Cannot read property 'full' of undefined
	at getProjectPath (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/gitlab/gitlab_new_service.js:67:58)
	at GitLabNewService.getDiscussions (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/gitlab/gitlab_new_service.js:235:29)
	at GitLabNewService.getDiscussionsAndLabelEvents (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/gitlab/gitlab_new_service.js:290:18)
	at initPanelIfActive (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/webview_controller.js:32:57)
	at processTicksAndRejections (internal/process/task_queues.js:93:5)
	at async WebviewController.create (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/webview_controller.js:143:9)
	at async WebviewController.open (/home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/webview_controller.js:130:26)
	at async /home/pouxa/.vscode/extensions/gitlab.gitlab-workflow-3.29.1/out/src/extension.js:35:9
	at async _executeContributedCommand (/opt/visual-studio-code/resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:85:109243)
	at async _executeContributedCommand (/opt/visual-studio-code/resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:85:109243)
```",1
92518812,2021-08-24 17:29:35.766,Optimize packaged extension,"[esbuild](https://github.com/evanw/esbuild) is an extremely fast JavaScript/TypeScript bundler. On my (admittedly powerful) PC, esbuild can bundle (and minify) this extension in ~40ms.

The main advantage is a reduction in the number and size of files loaded by VSCode. Currently, the packaged extension contains ~3500 files:

* `node_modules/` - ~2900 files
* `out/` - ~400 files
* `src/` - ~200 files - **these should be added to .vscodeignore**, since source files are not needed at runtime
* Miscellaneous other - 25 files

Using esbuild can reduce the total file count to ~30 by bundling each entry point into a single file, thus eliminating `node_modules` and `out`. AFAIK, there are two entry points: main and webview.

Removing `src` reduces the extension size by 2.2MB. Bundling the main entry point and eliminating `node_modules` and `out` reduces the extension size by 9MB. This is size of the files, after unpacking the extension from the .vsix/ZIP. This does not include the webview, because I'm not sure how to use esbuild with Vue.

I am interested in submitting an MR.",2
92093995,2021-08-17 08:50:09.893,Spike: Debug custom SSL Certificate issues,"### Summary

The extension has issues connecting to instances that use a self-signed SSL certificate (not signed by a root authority included in `node`) (Epic: https://gitlab.com/groups/gitlab-org/-/epics/6244). The goal of this spike is to create a local environment where the server uses self-signed certificate. In this environment, we are going to test setting up the `gitlab.ca`, `gitlab.cert`, `gitlab.certKey`, and `gitlab.ingnoreCertificateErrors`.

### Output of this spike:

1. Documentation about the current support of self-signed certificates in the README - this will help users to set up their extension. If the extension doesn't support self-signed certificates, we'll document that.
1. Triage of existing issues in https://gitlab.com/groups/gitlab-org/-/epics/6244
1. If `cross-fetch` (our library for making HTTPS requests) doesn't support self-signed SSL, this spike will document possible alternatives",2
90519846,2021-07-19 20:01:53.257,Markdown renderer in Gitlab Workflow VSCode extension allows arbitrary HTML attributes on whitelisted elements,"**[HackerOne report #1261073](https://hackerone.com/reports/1261073)** by `arw9234` on 2021-07-14, assigned to GitLab Team:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#####  Summary

I'm not sure whether something like this would be accepted without a larger impact, but I figured I should report it nonetheless.

The Gitlab VSCode extension renders gitlab flavored markdown in a few places, mostly just in issues and merge requests. When doing so, it sends the markdown to be rendered to the connected Gitlab instance where it is processed server-side. However, the extension then [mutates the resulting HTML with regexes](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/src/webview_controller.ts#L104) before incorporating it into the document using the following function:

```ts  
private createMessageHandler = (  
	panel: vscode.WebviewPanel,  
	issuable: RestIssuable,  
	repositoryRoot: string,  
) => async (message: any) => {  
	const instanceUrl = await getInstanceUrl(repositoryRoot);  
	if (message.command === 'renderMarkdown') {  
		let rendered = await gitLabService.renderMarkdown(message.markdown, repositoryRoot); // <--- clean HTML from server  
		rendered = (rendered || '')  
			.replace(/ src="".*"" alt/gim, ' alt') // <--- dangerous alteration of HTML with regexes  
			.replace(/"" data-src/gim, '"" src')  
			.replace(/ href=""\//gim, ` href=""${instanceUrl}/`);

	// ...  
}
```

The above code attempts to remove/alter specific attributes within the resulting HTML. In particular, the `/ src="".*"" alt/gim` regex tries to remove `src` attributes followed by an `alt` attribute, but could be made to break out of quoted attributes or change the nesting order of elements. For example, the following HTML:  
```html  
<div color="" src="" title="""" alt="" someattr='somevalue'""></div>  
```  
Will pass through Gitlab's markdown renderer relatively unchanged (`color`, `title`, and `alt` are [whitelisted on all elements](https://github.com/gjtorikian/html-pipeline/blob/v2.12.3/lib/html/pipeline/sanitization_filter.rb#L59), and `<div>` is a whitelisted element), but the ` src="" title="""" alt` sequence would then be matched and replaced by ` alt` with the above regex, resulting in:  
```html  
<div color="" alt="" someattr=""somevalue"" ""=""""></div>  
```  
Where the `someattr` attribute has broken out of the `alt` attribute and became part of the DOM. This allows for arbitrary HTML attributes to be added to any element whitelisted by the sanitization filter.

This is limited, however, in that the affected frame is [using a nonce-based CSP](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/src/webview/public/index.html#L5) that restricts inline event handlers and `javascript:` URIs.  If it were possible to inject arbitrary HTML elements as well, it could be possible to inject `<iframe>`/,`<object>` tags since the `object-src` directive is missing from the CSP. This would most likely require gitlab's GFM renderer to emit unescaped angle bracket characters in a quoted attribute, which it does not seem very keen on doing, but I will keep looking into it.

#####  Steps to reproduce

You can reproduce this yourself as follows:  
1. [Install Visual Studio Code](https://code.visualstudio.com/download) and the [Gitlab Workflow extension](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow)  
2. Create a personal access token and add it to the extension to link it to your gitlab account. Instructions can be found [here](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow#setup)  
3. In a new or existing project, create an issue with the following markdown in the description:  

```html  
<div color="" src="" title="""" alt="" style='display: block; position: absolute; width: 100vw; height: 100vh; left: 0; top: 0; z-index: 999999; background-color: black;' onmouseover='throw /this will raise a CSP violation/'"">  
	<h1>arbitrary style attr injected</h1>  
</div>  
```

4. Assign the issue to the same user whose access token you used to set up the extension  
5. Clone the repository locally in vscode  
6. If prompted, grant trust to the repository - vscode disables all extensions if you deny trust to the repo  
7. Click the gitlab icon in the left-hand menu  
8. On the left-hand side, expand `ISSUES AND MERGE REQUESTS > Issues assigned to me`  
9. Open the newly created issue  
10. The editor window will be filled with a black menu with the text 'arbitrary style attr injected', indicating the `style` attribute was injected into the DOM. You can also open `Help > Toggle Developer Tools` to see the source code for the page and to see CSP violations printed to the console

#####  Impact

An attacker can submit a malicious issue/merge request to a project that could contain arbitrary HTML attributes on whitelisted elements when opened in vscode. The impact of this is limited with inline event handlers blocked by the CSP, but this could still allow restyling of the page, injecting hrefs with arbitrary protocols on anchor elements (`javascript:` uris obviously won't be executed, but other protocols could be used, such as custom protocols registered by other applications), and injecting other potentially dangerous attributes.

#####  Examples

See the attached OVA.

#####  What is the current *bug* behavior?

The markdown renderer in the GitLab Workflow VSCode extension uses a poorly designed regex to alter attributes on HTML elements which can be induced to change the structure of the HTML returned from the server.

#####  What is the expected *correct* behavior?

The markdown renderer should either:  
	- not change the HTML returned from the server, or  
	- parse the HTML and update the relevant attributes using `setAttribute(...)`/`removeAttribute(...)`/similar before inserting it into the DOM  
so that the structure of the document is not changed

#####  Relevant logs and/or screenshots

Below is a screenshot of what the window should look like after opening the issue:  
![VSCode_Extension_Attr_Injection_1.png](https://h1.sec.gitlab.net/a/f4a66084-5a26-4967-8048-7b2043d49d7d/VSCode_Extension_Attr_Injection_1.png)

Below is a screenshot showing the CSP violations printed to the console due to the `onmouseover` handler:  
![VSCode_Extension_Attr_Injection_2.png](https://h1.sec.gitlab.net/a/efea9d95-9bee-47d6-bef5-e6552bc64a39/VSCode_Extension_Attr_Injection_2.png)

#####  Output of checks

Not applicable to GitLab.com

######  Results of GitLab environment info

N/A

Best regards,  
[@]arw9234

####  Impact

An attacker can submit a malicious issue/merge request to a project that could contain arbitrary HTML attributes on whitelisted elements when opened in vscode, allowing for restyling of the page, injecting hrefs with arbitrary protocols on anchor elements, and injecting other potentially dangerous attributes. A CSP bypass or ability to inject `<object>` tags could potentially increase impact.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [VSCode_Extension_Attr_Injection_2.png](https://h1.sec.gitlab.net/a/efea9d95-9bee-47d6-bef5-e6552bc64a39/VSCode_Extension_Attr_Injection_2.png)
* [VSCode_Extension_Attr_Injection_1.png](https://h1.sec.gitlab.net/a/f4a66084-5a26-4967-8048-7b2043d49d7d/VSCode_Extension_Attr_Injection_1.png)

## How To Reproduce

Please add [reproducibility information] to this section:

1.
1.
1.

[reproducibility information]: https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues",1
90241604,2021-07-14 08:13:26.478,Move documentation images away from the `main` branch,"### Problem to solve

We currently store all documentation images in [`src/assets` on the `main` branch](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/main/src/assets).

The images currently take about 13 MB.

This has several problems:

- It increases the size of the repository for cloning
- All pictures need to be referenced in `README.md` with absolute URLs (because [the README is also rendered in the Marketplace](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow))
  - this means that we need to use links in a format like https://gitlab.com/gitlab-org/gitlab-vscode-extension/raw/main/src/assets/_diff-comments.gif in the MR, but they don't work till the MR gets merged to `main`
- The images are in the wrong folder (I'd expect `src/` folder to contain files needed for the extension runtime)
- some of these images get packaged with the extension, where they increase the download size without any purpose (this could be ""fixed""[^1] without removing the images from `main`)

   <details>

    ```
    ~/.v/e/g/s/assets ❯❯❯ ll
    Permissions Size User  Date Modified Name
    .rw-r--r--   27k tomas 13 Jul 15:01  gitlab-logo.png
    .rw-r--r--  207k tomas 13 Jul 15:01  gitlab-vscode.png
    drwxr-xr-x     - tomas 13 Jul 15:01  images
    .rw-r--r--  892k tomas 13 Jul 15:01  insert-multi-file-snippet.gif
    .rw-r--r--  149k tomas 13 Jul 15:01  logo.png
    .rw-r--r--   44k tomas 13 Jul 15:01  pipeline-actions.png
    .rw-r--r--   74k tomas 13 Jul 15:01  screencast-cover.jpg
    ~/.v/e/g/s/assets ❯❯❯ pwd
    /Users/tomas/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.26.0/src/assets
    ```

    This is controled by the expression in [`.vsignore` file](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/.vscodeignore)

    </details>

### Proposal

There are two options I can think of:

- put the images outside of git (e.g. imgur.com)
- put the images into a separate git branch (e.g. `images` or `documentation-assets`) and make this branch protected

My preference would be the `images` protected branch.

### Further details

The migration must happen in several steps:

1. copy the images outside of the `main` branch and change the links in `README.md`
1. **Wait for a few months** (because older versions of the README still reference the resources in `main` branch)
1. Remove the images from the main brach.

### Links / references

[^1]: Fixed is in quotes because, without some automated checking, we are bound to forget to put the `_` prefix to some future documentation image.",1
89521269,2021-06-30 08:18:49.815,Change behaviour of the extension based on GitLab version,"### Problem to solve

Currently we support all GitLab versions from 13.5 onwards [1](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/359). But sometimes we either need to introduce a new feature that's only supported in newer versions of GitLab or we need to fix a bug (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/397) in different ways for the latest GitLab version and the older versions.

### Proposal

We are parsing the version for the GitLab instance since https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/252. We can reuse this logic and create a branching based on it:

```js
function getSnippetContent(){
  if (semver.lte(version, '14.1.0') {
    return getSnippetContentLegacy();
  }
  return getSnippetContentNew();
}

/* REMOVE AT 14.1.x: deprecated, doesn't work for versions lower than 14.1.0, remove when we stop supporting 14.0.x */
function getSnippetContentLegacy(){
}
```

### Further details

This might be tricky when we change GraphQL queries to match the new functionality. When GraphQL receives a query for a parameter that doesn't exist, it errors out instead of ignoring that parameter. This is going to be problem if we want to only introduce a feature for newer GitLab versions but the older instances would start returning errors for the whole query.

### Links / references",2
89425150,2021-06-28 17:46:40.512,Pipelines progress and logs views,"I use most of the features in gitlab and found gitlab vscode intact with all the features except gitlab CI is the best service and awesome tool that I use everyday in every project.

### Problem to solve

As a developer who spend all working hours in vscode, I would love to see all pipelines with logs and jobs.

![test-unit___1391199576____Jobs___GitLab_org___gitlab-vscode-extension___GitLab_and_fish__Users_tomas_and_Slack_____Google_Calendar___GitLab](/uploads/be4ae16fe815adc6da8550ac67b637c2/test-unit___1391199576____Jobs___GitLab_org___gitlab-vscode-extension___GitLab_and_fish__Users_tomas_and_Slack_____Google_Calendar___GitLab.png)


### Proposal

<!-- How are we going to solve the problem? -->

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

### Links / references",2
88764313,2021-06-15 17:57:16.515,Spike: Implement remote repositories similar to GitHub,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

<!-- What problem do we solve? Try to define the who/what/why of the opportunity as a user story. For example, ""As a (who), I want (what), so I can (why/value)."" -->
Microsoft recently [introduced](https://code.visualstudio.com/blogs/2021/06/10/remote-repositories) a new RemoteHub extension which made it possible to view and edit GitHub repositories without cloning them. It will be a very good idea to implement the same functionality in this extension in regard to GitLab.


### Proposal

<!-- How are we going to solve the problem? -->
There is a [documentation](https://github.com/microsoft/vscode/wiki/Virtual-Workspaces) about the underlying Virtual Workspaces API which is used to implement that extension. Unfortunately, the original extension is not open source, but there is an [issue](https://github.com/microsoft/vscode/issues/123115) about Virtual Workspaces API proposals and questions.

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

### Links / references",2
88756354,2021-06-15 14:58:02.756,POC: Include GitLab CI code quality feedback in the MR diff view,"### Problem to solve

GitLab allows code quality tools to display results in the diff view: https://docs.gitlab.com/ee/user/project/merge_requests/code_quality.html#code-quality-in-diff-view

The VS Code extension doesn't surface code quality.


### Proposal

Create POC that would expose some code quality metrics in the MR review view in GitLab Workflow

# Result of the POC

This document shows the proof of concept of how we could integrate Code Quality reports into VS Code.

In this document I'll look at the available code quality report, available VS Code API for surfacing this report and then I'll suggest possible implementations.

## TL;DR

- Check out the videos of possible implementations for normal editor view and MR diff view.
- The POC uses downloaded json artefact, there's no API ATM.
- If we want to enrich the normal editor view (not MR diff), we'll have a hard time showing the errors if the text files have added/removed lines since the report was generated.
- code is in [`code-quality-poc` branch](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/commits/code-quality-poc)

## Code Quality Report

I used the `gl-code-quality-report.json` JSON artefact from [`code_quality`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/jobs/1455192063) job

The report is an array of error messages:

``` json
{
	""engine_name"": ""structure"",
	""fingerprint"": ""a54cbeb36914a3fde6c04a1f5fb57155"",
	""categories"": [
	""Complexity""
	],
	""check_name"": ""method_complexity"",
	""content"": {
	""body"": ""# Cognitive Complexity\nCognitive Complexity is a measure of how difficult a unit of code is to intuitively understand. Unlike Cyclomatic Complexity, which determines how difficult your code will be to test, Cognitive Complexity tells you how difficult your code will be to read and comprehend.\n\n### A method's cognitive complexity is based on a few simple rules:\n* Code is not considered more complex when it uses shorthand that the language provides for collapsing multiple statements into one\n* Code is considered more complex for each \""break in the linear flow of the code\""\n* Code is considered more complex when \""flow breaking structures are nested\""\n\n### Further reading\n* [Cognitive Complexity docs](https://docs.codeclimate.com/v1.0/docs/cognitive-complexity)\n* [Cognitive Complexity: A new way of measuring understandability](https://www.sonarsource.com/docs/CognitiveComplexity.pdf)\n""
	},
	""description"": ""Function `parseQuery` has a Cognitive Complexity of 6 (exceeds 5 allowed). Consider refactoring."",
	""location"": {
	""path"": ""src/search_input.js"",
	""lines"": {
		""begin"": 6,
		""end"": 88
	}
	},
	""other_locations"": [],
	""remediation_points"": 250000,
	""severity"": ""minor"",
	""type"": ""issue""
},
```

Each error message contains `description`, `severity`, and `location` of the problem amongst a few extra details.

## VS Code API

Diagnostic](https://code.visualstudio.com/api/references/vscode-api#Diagnostic) interface allows us to put error/warning/info messages on any location in any file (including MR diff), this is the [Errors & Warnings](https://code.visualstudio.com/docs/editor/editingevolved#_errors-warnings) feature from the user perspective.

Diagnostic consists of location in the code, severity, message and source. All visible on the following screenshot:
		
![_Extension_Development_Host_-_status_bar_test_ts___gitlab-vscode-extension-TEST_1627460731204_0](/uploads/a2995397186df78a7539dc72a02198ae/_Extension_Development_Host_-_status_bar_test_ts___gitlab-vscode-extension-TEST_1627460731204_0.png)

## Possible implementation

### MR diff view
We would show the code quality information in the MR review Diff. Showing every error from the `gl-code-quality-report.json` doesn't make sense here because the MR author is not responsible for most of the issues. Here we would **need an API endpoint** that exposes the diff (existing/new errors) for each MR. (We could also download the artefact from `main` branch and from the MR branch and diff them, but that sounds like a lot of effort.)

![mr-diff-view](/uploads/453348f5b29f215ab20b96ab1b6ea17a/mr-diff-view.mp4)

### Normal editor view

We can also just add all the Code Quality errors directly into user's editor which will highlight problems in the file tree, show them in the editor and also in the ""Problems"" output panel at the bottom. This works well even with the whole `gl-code-quality-report.json` (except for causing too much noise).

- We could have a right-click context menu (e.g. ""show code quality"") on each pipeline with `code-quality` job. This right-click would download the artefact and show all the errors.
- We could only download the errors that are newly introduced by the MR (when there's an API endpoint) and show them.

![normal-editor-view](/uploads/7c2b1928525300d19f21c8cb463cb528/normal-editor-view.webm)

## General problems

### Too much noise

Highlighting whole blocks of code is very intrusive compared to normal warnings (e.g. eslint)

| very targetted warning by most of the extensions | code quality marking the whole file as having too many lines |
| ------ | ------ |
| ![process_code_quality_ts___gitlab-vscode-extension_1627395552714_0](/uploads/0d391f1d4e78063c7fcc915039a4d873/process_code_quality_ts___gitlab-vscode-extension_1627395552714_0.png) | ![_Extension_Development_Host__-_gitlab_new_service_ts___gitlab-vscode-extension-TEST](/uploads/f9b197ef7c6121ffe1916fae9b8f310f/_Extension_Development_Host__-_gitlab_new_service_ts___gitlab-vscode-extension-TEST.png) |

On top of highlighting the whole blocks, the `gl-code-quality-report.json` only contains lines on which the problem occurs, not columns. So if an error applies only to a symbol or two, we still highlight the whole line.

``` json
{
    ""location"": {
        ""path"": ""src/search_input.js"",
        ""lines"": {
        ""begin"": 6,
        ""end"": 88
        }
    },
}
```

#### Possible solutions to the ""Too Much Noise"" problem

- show the error/warning on the first line of the complexity issue, contributed by @KevSlashNull (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/410#note_638971740)
- not showing complexity errors (and other kinds that would highlight 10+ lines) or at least not by default
- add an easy way to toggle the visibility of these errors (adding a button to the editor or to the status bar)
	  
### Making sure the report is are up to date

VS Code handles moving the `Diagnostic` highlights with changes, but it incorrectly highlights if the changes happened before we generated the `Diagnostic`

| Diagnostic objects generated before changes | Diagnostic object generated after changes |
| ------ | ------ |
| ![errors-before-changes](/uploads/1cc1544a04b7e396d2a91c722ddf87d8/errors-before-changes.webm) | ![errors-after-changes](/uploads/58adb7d2da6a3d75fd79e871d4ea261b/errors-after-changes.webm) |
| VS Code can automatically track the error even when there are new/removed lines | VS Code highlights wrong lines, because it can't know that we are giving diagnostic for different version of the file |

## Mapping Code Quality report error on diagnostic

There are a few attributes in the code quality report, which don't have a natural place in the `Diagnotic` object.

- `engine_name`
- `check_name`
- `categories` would have to be somehow included in the message or the source.

`eslint` includes this in the source part ( `@typescript-eslint/no-unused-vars` )

![process_code_quality_ts___gitlab-vscode-extension_1627461501748_0](/uploads/136375bd780938bb08bbd7fbcb33fd5f/process_code_quality_ts___gitlab-vscode-extension_1627461501748_0.png)

### Severity

It seems that we've got only two severities in the report `minor` / `major` but VS Code offers four:


| severity | visual |
| ------ | ------ |
| error | ![_Extension_Development_Host_-_create_snippet_ts___gitlab-vscode-extension-TEST_1627461073097_0](/uploads/2819bcb6408f26a848acb1eb18f2f8eb/_Extension_Development_Host_-_create_snippet_ts___gitlab-vscode-extension-TEST_1627461073097_0.png) |
| warning | ![_Extension_Development_Host_-_status_bar_test_ts___gitlab-vscode-extension-TEST_1627460731204_0](/uploads/828813a7f569d315422462fca93e1886/_Extension_Development_Host_-_status_bar_test_ts___gitlab-vscode-extension-TEST_1627460731204_0.png) |
| info | ![command_names_ts___gitlab-vscode-extension_1627461188785_0](/uploads/2e9b8299042b7a5e8667d696471b9699/command_names_ts___gitlab-vscode-extension_1627461188785_0.png) |
| tip | ![Screenshot_2021-07-28_at_10.34.30_1627461351258_0](/uploads/3a4cd61facb4e61a6cd55c7490e9d26d/Screenshot_2021-07-28_at_10.34.30_1627461351258_0.png) |",2
88741500,2021-06-15 11:45:09.945,Context menu shows when trying to add an MR comment + duplicated comments,"### Summary

Opening MR item multiple times in different places in the side-panel registers multiple comment controllers. That results in UX that lets the user choose which controller to use (context menu) and it will cause every MR diff comment to show twice.

![Screenshot_2021-06-15_at_15_30_27](/uploads/458a8c2e1aa8661e8ebe229833601a5a/Screenshot_2021-06-15_at_15_30_27.png)

![double-comment-controller-2](/uploads/4f2f3f1f6697e47cd0b5bbba324e0902/double-comment-controller-2.mp4)

### Steps to reproduce

1. Click on an MR in the extension side panel in multiple places:
  - For example, you open ""Merge requests assigned to me"" and ""All project merge requests"", and open the same MR in both views
1. Open one changed file in this MR
1. Try to add a comment - you'll see a context menu
1. If the MR contains comments on the MR diff, you'll see them twice.

### What is the current *bug* behavior?

- You have to choose which controller to use from the context menu
- You see comments on the diff twice

![Screenshot_2021-06-15_at_13_35_06](/uploads/1d895af1d4fedc9edd9246baa499a87d/Screenshot_2021-06-15_at_13_35_06.png)

### What is the expected *correct* behavior?

- A new comment thread should open as usual.
- Each comment shows only once

### Workaround for adding comments

Choosing  one of the options will work fine:

![choosing-controller](/uploads/782a11432e74d9ff5762327e39570265/choosing-controller.gif)

### Possible fixes

We must ensure that only one commenting controller gets initialized.",1
88666251,2021-06-14 11:24:09.472,"Add ""View as Tree"" option","<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

Right now the extension shows the changes of an MR as flat list. Each element in the list has the path next to it. This works pretty well but for bigger mono repos it is hard to review. VSCode itself support the ""View as Tree"" option in the git diff view. This will show the changes within it's directories 

![image](/uploads/8ed7bada1003b5887270555457f873c5/image.png)

GitLab support this as well :wink: 

### Proposal

Add a button (View as Tree) similar to VSCode diff view to switch between this 2 variants. This would make reviewing in some cases much easier.

### Further details

Checkout the git diff view of VSCode with some sub directories to see the effect in action.

### Links / references",2
88515812,2021-06-10 11:12:43.200,MR Review: indicate which changed files have MR discussions,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

When I'm reviewing MR's I don't know which files have MR discussions before I show the diff and scroll to the comment.

### Proposal

I propose the same solution as GitHub Pull Request extension uses. Add a text bubble emoji decoration the same way we add decoration for the type of change.

![_Extension_Development_Host__-_webview_controller_js___gitlab-vscode-extension-TEST_and_extension_js___gitlab-vscode-extension](/uploads/6841da534bdc198ad2e900b47d75fd33/_Extension_Development_Host__-_webview_controller_js___gitlab-vscode-extension-TEST_and_extension_js___gitlab-vscode-extension.png)

### Further details

#### GitHub Pull Request Screenshot

![Getting_Started___github-test-repository](/uploads/7352c18bfca0eb1d41c0e29fdfe4f6d2/Getting_Started___github-test-repository.png)

### Links / references

I created a POC, the change seems fairly simple https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/commits/commenting-decorator-poc

/cc @phikai @pedroms",2
88038534,2021-06-01 13:00:18.553,MR Review: improve UX when extension fails to create new comment,"### Problem to solve

We implemented creating comments on MR diff in https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/342.

The happy-path scenario works well, but when the comment fails to send (network failure, GitLab API unavailable) the UX is not great. We show the user an error message and store the comment text in extension logs, but we don't offer an easy way to retry sending the comment. Each failure has to be followed by copy-pasting the comment text from logs and trying again.


### Proposal

We should handle the failure similarly to the GitHub Pull Request extension. We should create a new type of comment (failed comment) which would have a button to retry.

1. Creating comment fails
1. Extension creates a failed comment and puts it into the diff discussion
1. The failed comment has a ""Retry"" button which lets users try to resend it

### Current UX

![new-comment-error](/uploads/74717853ba06403865b21dda8b03a57a/new-comment-error.mp4)",2
87978417,2021-05-31 13:44:00.609,Inserting snippets is broken for newly created snippets,"### Summary

Newly created snippets can't be inserted. Applies only to `gitlab.com` (and soon to `14.0`)

This issue is caused by GitLab switching to `main` branch name.

### Steps to reproduce

1. Create a project snippet
1. Try to insert it with `GitLab: Insert snippet` command

### What is the current *bug* behavior?

When calling API to get the snippet blob, you get 404

### What is the expected *correct* behavior?

inserting the snippet

### Relevant logs and/or screenshots

The extension makes a call like:

```sh
curl -H ""PRIVATE-TOKEN: $TOKEN"" ""https://gitlab.com/api/v4/projects/20486274/snippets/2128747/files/master/blah.patch/raw""
```

(notice the **master** branch in the request)

We should instead make call to 

```sh
curl -H ""PRIVATE-TOKEN: $TOKEN"" ""https://gitlab.com/api/v4/projects/20486274/snippets/2128747/files/main/blah.patch/raw"" 
```

(notice the **main** branch in the request)",1
87800877,2021-05-27 08:53:39.276,create snippet from git patch and apply patch stored in a snippet,"### Problem to solve

When I review MR, sometimes I want to suggest changes that span multiple lines in multiple files and the ""suggestions"" GitLab feature is not powerful enough for that.

Then I result in creating the changes locally, running `git diff > suggestions.patch` and including this patch to one of my MR comments.

### Proposal

Introduce two new commands: `Create patch snippet` and `Apply patch snippet`.

![poc video](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/93f89519e56c165c63b08d2e6658b9cb/snippet-patch-poc.mp4)

#### `Create patch snippet`

1. run the command
1. VS Code asks for the patch name and visibility
1. VS Code runs `git diff` to get the patch
1. project snippet with name `patch: <name submitted by the user>` is created

#### `Apply patch snippet`

1. run the command
1. VS Code shows a list of all snippets with `patch: ` name prefix
1. select one patch
1. VS Code runs `git apply` to apply the patch

### Further details


### Links / references

/cc @phikai",2
87293716,2021-05-18 15:56:33.145,Add support to open local file during MR reviews (file diff view),"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""feature"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=feature

and verify the issue you're about to submit isn't a duplicate.
--->

### Problem to solve

When reviewing a merge request sometimes it's better to have better insights on the file like the file path, checkout neighboring files and folder etc.. and sometimes we might even need to open the file in the local to make a small change to see if it would workout or not.


### Proposal

Utilize a native feature in VScode to open a diff view while knowing the local path of that file, that will enable few features in VScode like (open file) button, the breadcrump and will allow some of ""gitlens"" extension features get activated

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->
Current GitLab Workflow MR file diff view actions:
![GL](/uploads/191f1af9864a2981ca6bb5d726375a23/GL.png)

Assumed to be an achievable behavior (Notice the breadcrumb and the ""open file"" action on the left): 
![GH](/uploads/2d0fa14bfa6f3f4cecba92f63ff1c7c8/GH.png)

I'm aware that the file path is already available on hover, but that doesn't exactly give the features of a breadcrumb found in VScode.
![GL_path](/uploads/af995896ee05058dc535cc7d89e75c8c/GL_path.png)

Some of the features activated by gitlens when a local file with history is diffed (Git blame, refs navigation):
![GH_gitlens](/uploads/adc8a3abe931a22b154dc605df16d849/GH_gitlens.png)
 
### Links / references
(I've no knowledge of the VScode APIs)",1
87279951,2021-05-18 12:16:23.128,Inserting snippet into user's snippets fails (multi-repository workspaces),"

### Summary

When a user tries to add a snippet to their user snippets (rather than project snippets) the command fails.

### Steps to reproduce

User tries to add a snippet to their user snippets (rather than project snippets):

1. Open folder containing multiple repositories
2. Open file from one of the repositories
3. Trigger the `GitLab: Create snippet` command
4. Select `User's Snippets` in the project selection
5. See the command fail

### Possible fixes

I added all caps comments to the following snippet from [create_snippet.js](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/ca514167e28766b74c24faba255802920468ce05/src/commands/create_snippet.js#L66-111)

```ts
async function createSnippet() {
  const editor = vscode.window.activeTextEditor;
  let repositoryRoot = null;
  let project = null;

  if (editor) {
    const repository = gitExtensionWrapper.getActiveRepository();
    repositoryRoot = repository && repository.rootFsPath;
    try {
      project = repository && (await repository.getProject());
    } catch (e) {
      logError(e);
    }

    // FIXME: the empty `uri` representing user's snippets is not correctly handled
    if (!project) {
      repositoryRoot = await gitlabProjectInput.show(
        [
          {
            label: ""User's Snippets"",
            uri: '', // HERE WE RETURN EMPTY STRING
          },
        ],
        ""Select a Gitlab Project or use the User's Snippets"",
      );
      try {
        const selectedRepository = gitExtensionWrapper.getRepository(repositoryRoot); // HERE WE EXPECT SOME VALID URL
        project = selectedRepository && (await selectedRepository.getProject());
      } catch (e) {
        logError(e);
      }
    }

    const visibility = await vscode.window.showQuickPick(visibilityOptions);

    if (visibility) {
      const context = await vscode.window.showQuickPick(contextOptions);

      if (context) {
        uploadSnippet(project, editor, visibility.type, context.type, repositoryRoot); // THIS FUNCTION NEEDS VALID repositoryRoot
      }
    }
  } else {
    vscode.window.showInformationMessage('GitLab Workflow: No open file.');
  }
}
```",1
86774523,2021-05-10 10:48:43.380,Change TreeView to list repositories first and then filters,"Follow-up from https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/345#note_569008314

### Problem to solve

As a user, I want to navigate my issues and <abbr title=""merge request"">MR</abbr>s using a “repository-first” hierarchy, so that its hierarchy matches other VS Code views and it doesn't make me think.

### Proposal

Change the extension's “Issues and merge requests” view to show repositories first and then the filters.

### Further details

| Current GitLab Workflow | explorer | source control | GitHub extension |
|----------|----------------|-----------------|-|
| ![settings_json___workspace](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/9a839aad560ebc8960a23c15e6430334/settings_json___workspace.png) | ![settings_json___workspace](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/785c11d232b242892b71bd444eb55cef/settings_json___workspace.png) | ![settings_json___workspace](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/4c68c4228d3bd0d15a3934c71d557de7/settings_json___workspace.png) | ![image](/uploads/3464d2984cf890c1b1122364bcbdf45d/image.png) |

### Links / references",1
86556184,2021-05-06 00:40:05.842,Add command to show merged YAML for CI config,"### Problem to solve

As a developer, I want to be able to view the merged YAML for my GitLab CI configuration inside my VSCode workspace, so that I don't have to leave my IDE and navigate through a web browser to see the results.

### Proposal

Utilize the API endpoint to [Validate a CI YAML configuration with a namespace](https://docs.gitlab.com/ee/api/lint.html#validate-a-ci-yaml-configuration-with-a-namespace), retrieve the `merged_yaml` attribute from the response, and display the results in a separate editor.

### Further details

For complex pipelines, it can be very challenging to know whether the resulting merged YAML is going to look as desired/expected. Having the ability to view this directly in the developer's IDE would be extremely valuable.

### Links / references

Might be blocked by https://gitlab.com/gitlab-org/gitlab/-/issues/320778.

We can use virtual documents to show the merged result: https://code.visualstudio.com/api/extension-guides/virtual-documents.

- We'd define a `TextDocumentContentProvider` that will serve documents on a custom scheme URI (e.g. `gitlab-merged-ci-yaml`)
    - this provider would somehow have to store the API response
- We'd show the file by running `vscode.workspace.openTextDocument(customUri)`",2
86520187,2021-05-05 12:36:34.312,Integrate with YAML extension to provide .gitlab-ci.yml autocompletion,"### Problem to solve

Since ci files are not created many times we never get to memorize all the **keys** to achieve what we need.

When creating a new gitlab-ci file I normally have to copy stuff from an existing file or open the documentation to see what are the yaml keys to get things done.

### Proposal

Add code completions to the actual yaml keys allowed by the gitlab-ci file schema, along with their description.

This can be achieved already by making the following steps:

1. install the [YAML](https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml) extension
1. change your `settings.json` associate the `.gitlab-ci.yml` file with the correct JSON Schema
    ```json
    {
      ""yaml.schemas"": {
        ""https://json.schemastore.org/gitlab-ci.json"": "".gitlab-ci.yml""
      }
    }
    ```

We should simplify the integration with YAML extension to make it even easier for the users to enable `.gitlab-ci.yml` auto-completion.

We can recognize that the YAML extension is installed (`vscode.extensions.getExtension<GitExtension>('redhat.vscode-yaml')`). If it is, we can somehow suggest to the user, that we can add configuration to enable the autocompletion.

```json
{
  ""yaml.schemas"": {
    ""https://json.schemastore.org/gitlab-ci.json"": "".gitlab-ci.yml""
  }
}
```

### Further details

We should agree on the UX before implementation.

- Do we do this change automatically and only inform user that we've done it?
- Are we going to show pop-up message with a button which will add the configuration?
    - If users dismisses this message, should we show it again, or never suggest it again?
- What if they've already have some configuration in their `yaml.schemas`? We must ensure it won't get lost


<details>
<summary>This snippet shows the changes we could do to edit YAML's config</summary>

```diff
diff --git a/package.json b/package.json
index a17bd0c..8ab2ea9 100644
--- a/package.json
+++ b/package.json
@@ -353,6 +353,9 @@
     ""configuration"": {
       ""title"": ""GitLab Workflow (GitLab VSCode Extension)"",
       ""properties"": {
+        ""yaml.schemas"": {
+          ""type"":""object""
+        },
         ""gitlab.instanceUrl"": {
           ""type"": [
             ""string"",
diff --git a/src/extension.js b/src/extension.js
index 7d81215..bebf082 100644
--- a/src/extension.js
+++ b/src/extension.js
@@ -107,7 +107,7 @@ const registerCiCompletion = context => {
   context.subscriptions.push(subscription);
 };
 
-const activate = context => {
+const activate = async context => {
   const outputChannel = vscode.window.createOutputChannel('GitLab Workflow');
   initializeLogging(line => outputChannel.appendLine(line));
   vscode.workspace.registerTextDocumentContentProvider(REVIEW_URI_SCHEME, new GitContentProvider());
@@ -120,6 +120,9 @@ const activate = context => {
   gitExtensionWrapper.init();
   context.subscriptions.push(gitExtensionWrapper);
   vscode.window.registerFileDecorationProvider(fileDecorationProvider);
+  await vscode.workspace
+    .getConfiguration()
+    .update('yaml.schemas', { 'https://json.schemastore.org/gitlab-ci.json': '.gitlab-ci.yml' });
 };
 
 exports.activate = activate;
```

</details>",1
86314631,2021-05-01 08:05:11.012,Replace Node Sass (node-sass) with Dart Sass (sass) in JavaScript,Part of &5923,2
85455078,2021-04-19 13:13:14.834,Support suggestions in VS Code diff comments,"### Problem to solve

GitLab supports a custom suggestion Markdown code blocks

    ```suggestion:-0+0
    suggested text
    ```

Which gets rendered on the web as

![Update_new-file2_txt___9____Merge_requests___Tomas_Vik___test_project___GitLab](/uploads/6c6285cd99149ac0b2201b1bab5cad3b/Update_new-file2_txt___9____Merge_requests___Tomas_Vik___test_project___GitLab.png)

but in VS Code it renders as a generic text block:

![_Extension_Development_Host__-_new-file2_txt___9____test-project](/uploads/c141d97dfaf0ae44e25b5a5aba370575/_Extension_Development_Host__-_new-file2_txt___9____test-project.png)

### Proposal

Implement a post-processing of comments in VS Code to convert the custom suggestion into a diff block:

~~~markdown 
```suggestion:-1+0
,--,
```
~~~

changes to

~~~markdown
Suggestion:

```diff
- 
- ,,,
+ ,--,
```
~~~

rendered as

![_Extension_Development_Host__-_new-file2_txt___9____test-project](/uploads/99be510904a9514adc31334844d4b08b/_Extension_Development_Host__-_new-file2_txt___9____test-project.png)

### Further details

- This would be quite complex because as seen in the previous example, suggestion can span multiple lines (`suggestion:-1+0`) and so the logic would have to work not only on comments but also access the text file to have the full context.

### Links / references",3
84688797,2021-04-06 08:17:34.525,Warn users that they should use supported GitLab version,"### Problem to solve

The extension doesn't work correctly with older GitLab versions (13.4 and older) (e.g. #347 #358). But the users don't have any way of finding this information and so the process currently looks like this:

1. GitLab instance returns an error
1. User creates a bug in extension issues
1. We try to help the user debug the issue
1. Eventually we ask about the GitLab version
1. User tells us an old version
1. We mark the issue as ~wontfix and explain to the user that we don't support old versions

### Proposal

#### Passive solutions

Passive solutions to the problem are trivial to implement, but they are not going to be as effective, because they rely on user reading the documentation for the extension.

- Add a note to the top of the README, that explains that the extension supports GitLab 13.5 and above.
- Add a section to the [Bug issue template](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/.gitlab/issue_templates/Bug.md)

#### Active solution

- When we start the extension, we can check the `/api/v4/version` response and if we find out that the version is lower than 13.5, we'll show the user a warning saying that they are connected to an unsupported version of GitLab instance and the extension won't fully work.

### Further details

- We already make use of the `version` endpoint: https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/c484feb48d44d8492a54be61b51637c781ef2b53/src/gitlab_service.ts#L170-181

### Links / references

/cc @phikai",1
81188307,2021-03-18 13:37:06.043,Use repositories instead of workspace folders,"# Use repositories instead of workspace folders

TL;DR: We use the wrong abstraction in the code. If we change the abstraction, we'll simplify the code significantly, make future work on the codebase much easier.

## What is a workspace?

Workspace is the content of an open VS Code window. It can either contain one open folder or multiple folders if you use [Multi-root Workspace](https://code.visualstudio.com/docs/editor/multi-root-workspaces).

| single foldre in the workspace | mutli-root workspace |
| ---- | ---- |
| ![e3c8ae52e5a24d82bfd88b406d150871](/uploads/828ff723636f899733269b1e1e2eb2f6/e3c8ae52e5a24d82bfd88b406d150871.png) | ![2e96f2863e554495b225c1770e775aa4](/uploads/305198895c82e53256e795ae03ef36d4/2e96f2863e554495b225c1770e775aa4.png) |


GitLab Workflow uses the workspace folder to run the `git` command. The most common use case is this:

```mermaid
graph TD;
A[Obtains workspaceFolder from VS Code] --""/workspace/extension""--> B[""Run git remote -v in that folder to get remote URL""]
B --""git@gitlab.com:gitlab-org/gitlab-vscode-extension.git""--> C[""parse namespace and project from the remote""]
C --""gitlab-org/gitlab-vscode-extension""--> D[""Run API queries for this project""]
```

### The problem with using `workspaceFolders`

The problem with this approach is that **the `workspaceFolder` doesn't have 1:1 relationship with repository**. You can open the VS Code in any folder (`code .` in the command line). If we have the following folder structure:

```
.
└── workspace/
    ├── projectA/
    │   ├── .git
    │   ├── frontend/
    │   │   └── src
    │   └── backend
    └── projectB/
        ├── .git
        └── src/
```

This structure allows for the following three scenarios:

1. Open `projectB` (`cd workspace/projectB && code .`) - ✅ This will work fine because the `workspaceFolder` is a git repository at the same time
2. Open `frontend` (`cd workspace/projectA/frontend && code .`) - ⚠️This now works, because there is still only one repository for the `workspaceFolder`. But it caused us trouble in the past:
	- 🐞 [Open active file on GitLab does not resolve from git repository root](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/327)
3. Open `workspace` (`cd workspace && code .`) - ❌ The extension will run `git` command in the folder called `worskpace` and think that there are no repositories. `workspace` folder contains two repositories.
    - 🐞 [Does not support workspace folders containing multiple repositories](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/216)


## Better approach: Using repositories

The key insight is that the `workspaceFolder` <--> git repository 1:n relationship makes it very hard to keep the extension git information in sync with VS Code.

We've recently introduced the VS Code Git extension to our codebase ([Support VSCode ""git clone"" command](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/222)) and now we can use the way VS Code recognizes repositories.

### Folder that contains multiple repositories

| explorer| source control (git) tree view | GitLab Workflow tree view |
| -- | -- | -- |
| ![cbdebfffbbb54267b27496f93ffd4718](/uploads/567e82034650e94b0b2e07499ec3acbf/cbdebfffbbb54267b27496f93ffd4718.png) | ![74b38c20d8b544f99efe3a0b4ed18367](/uploads/d157e0084e1c5dcc7b410da04f28c75c/74b38c20d8b544f99efe3a0b4ed18367.png) | ![0197b75bb9b6465bab9c1459eb5fcd84](/uploads/2813581eb23320951549eeab427c6f88/0197b75bb9b6465bab9c1459eb5fcd84.png) |

### Benefits of switching to repositories

- Benefits of changing the abstraction
  - Clear abstraction. GitLab project = git repository. Easy to understand for new and existing contributors.
- Benefits of switching to the VS Code git extension
  - **Single source of truth for the git information**, if user sees 4 repostiories in the SCM tree view, they'll see up to 4 in the GitLab Workflow TreeView
  - Less dependency on `execa` module to run our custom `git` commands and parse them. Running the git commands ourselves is tricky from a security perspective (e.g. [Client side code execution](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/170))


### Drawbacks of switching to repositories

There is no drawback (that I can think of) of **changing the abstraction**. However, there is a drawback of using the VS Code Git extension:

- Dependency on the VS Code Git extension means that if there is a bug or a missing feature, we are not fully in control, and we can only contribute the fix upstream and wait for a release.
	- There is plenty of popular extensions (GitHub Pull Request, Git Lenses) depending on the same API, the ""severe bug"" scenario is not very likely.
	- We can still use `execa` for any missing git commands/features, but I don't know of any.

## Getting technical

**(some experience with the extension code is recommended)**

I have implemented a POC of this change in [refactor-to-use-git-repositories](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/refactor-to-use-git-repositories) branch. The potential for simplifying the code got me excited enough to write this issue.

### Opportunity for simplifying the codebase

The way we now obtain information about the git repository or how we call API is quite complex. If we create a wrapper around the `Repository` that we get from VS Code Git extension, we can reduce a significant amount of code and complexity from the extension[^1].

<details>
	<summary>Good example</summary>

In this example, we already built the GitLabNewService to be decoupled from the repository logic.

[Getting the `GitLabNewService`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/42ba142134b0ace97ae56a36f2f1131eba212a39/src/service_factory.ts#L16-18)

```ts
export async function createGitLabNewService(workspaceFolder: string): Promise<GitLabNewService> {
  return new GitLabNewService(await getInstanceUrl(workspaceFolder));
}
```

[Using the new service](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/c012837326fca58ec4dcf4e85fe94f3483a261f3/src/commands/insert_snippet.ts#L34-37):

```
 const gitService = createGitService(workspaceFolder);
  const gitLabService = await createGitLabNewService(workspaceFolder);
  const remote = await gitService.fetchGitRemote();
  const snippets = await gitLabService.getSnippets(`${remote.namespace}/${remote.project}`);
```

</details>

<details>
	<summary>Bad example</summary>

The old GitLabService is incredibly coupled with the workspace and git logic:

```ts
export async function getAllGitlabWorkspaces(): Promise<GitLabWorkspace[]> {
  if (!vscode.workspace.workspaceFolders) {
    return [];
  }
  const projectsWithUri = vscode.workspace.workspaceFolders.map(async workspaceFolder => {
    const uri = workspaceFolder.uri.fsPath;
    try {
      const currentProject = await fetchCurrentProject(uri);
      return {
        label: currentProject?.name ?? basename(uri),
        uri,
      };
    } catch (e) {
      logError(e);
      return { label: basename(uri), uri, error: true };
    }
  });

  return Promise.all(projectsWithUri);
}
```

```ts
export async function fetchCurrentProject(workspaceFolder: string): Promise<GitLabProject | null> {
  try {
    const remote = await createGitService(workspaceFolder).fetchGitRemote();

    return await fetchProjectData(remote, workspaceFolder);
  } catch (e) {
    throw new ApiError(e, 'get current project');
  }
}
```

</details>

I imagine the new repository centric approach like this:

```js
const activeEditor = vscode.workspace.activeEditor;
const gitlabRepository = repositoryManager.getRepositoryForFile(activeEditor.document.uri);
const snippets = await gitlabRepository.gitlabService.getSnippets();
const activeBranch = await gitlabRepository.git.getActiveBranch();
```

## Related

- [Consistent handling of remotes, instances and branches](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/260)
- [Replace the library for interacting with git](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/203)

[^1]: I'm confident that even with covering the new logic with unit tests, we'll end up with less code in total.",3
81119370,2021-03-17 15:51:58.781,MR Review: track changed lines on the diff,"### Problem to solve

This issue is a follow up for https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/340 that might be not necessary to implement if the https://gitlab.com/gitlab-org/gitlab/-/issues/325161 gets fixed.

This issue implements logic related to tracking which lines in the diff have been added/removed/unchanged. This feature needs to be behind a feature flag because we'll implement submitting new comments in a subsequent issue.

#### Commenting ranges

To be able to create new comments (not replies to a thread) we need to create a [`CommentingRangeProvider`](https://code.visualstudio.com/api/references/vscode-api#CommentingRangeProvider). We implement a function that receives a file URI and returns all the lines that the user can comment on.

Without these ranges, the user can only respond to existing comments (#339).

#### Track changed lines on the diff

To be able to submit comments on unchanged lines, we also need to be able to track position of unchanged lines across both old and new diff version. The `createDiffNote` GraphQL mutation requires both `oldLine` and `newLine` for unchanged lines (this is an issue tracked in https://gitlab.com/gitlab-org/gitlab/-/issues/325161). The following image explains the information we must compute:

![_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST](/uploads/1d7b3ca4f7a9cfc00d91d5a6379156f5/_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST.png)

To be able to submit a comment for the `it('deletes a comment', async () => {` line, we need to compute that the line has the number `133` on the old version but `149` on the new.

### Proposal

We'll need to use the textual diff that we retrieve from the [MR Diff version API endpoint](https://docs.gitlab.com/ee/api/merge_requests.html#get-a-single-mr-diff-version).

```json
{
  ""old_path"": ""new_file.ts"",
  ""new_path"": ""new_file.ts"",
  ""a_mode"": ""0"",
  ""b_mode"": ""100644"",
  ""new_file"": true,
  ""renamed_file"": false,
  ""deleted_file"": false,
  ""diff"": ""@@ -0,0 +1,3 @@\n+export class NewFile{\n+    private property: string;\n+}\n""
}
```

We'll have to praise the `diff` property to find all changed lines.

### Further details

Example:

| no ranges | with ranges |
| ------ | ------ |
| ![gitlab_comment_thread_test_ts___197____gitlab-vscode-extension](/uploads/68d82d72b633a1cd187b1dbbb1973363/gitlab_comment_thread_test_ts___197____gitlab-vscode-extension.png) | ![_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST](/uploads/f64380715c20a6a230e17dd8c95f00ce/_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST.png) |

### Links / references",2
81037359,2021-03-16 17:25:01.077,MR Review: create a new comment on the diff,"### Problem to solve

The extension only allows creating new comments on the ""Details""  `webview` which means they are not related to any particular position. To replicate the GitLab web experience, this ~feature implements creating new comments in the MR diff view.

### Proposal

![new_comments](/uploads/cd27d196a2c53b0698650baf587d23e5/new_comments.mp4)

Implement a command that will be triggered when the user clicks ""Add comment now"" button:

![_Extension_Development_Host__-_test_ts___5____test-project](/uploads/0f1044ee573794ef21ec8f976982b545/_Extension_Development_Host__-_test_ts___5____test-project.png)

This command will create a new comment. It will support unchanged, removed, and added lines.

### Further details

#### Creating comments

GraphQL mutation

```graphql
mutation CreateDiffNote5 {
  createDiffNote(
    input: {
      noteableId: ""gid://gitlab/MergeRequest/87196674""
      body: ""new note""
      position: {
        baseSha: ""5e6dffa282c5129aa67cd227a0429be21bfdaf80""
        headSha: ""a2616e0fea06c8b5188e4064a76d623afbf97b0c""
        startSha: ""5e6dffa282c5129aa67cd227a0429be21bfdaf80""
        paths: { oldPath: ""/test.js"", newPath: ""/test.ts"" }
        newLine: 15
      }
    }
  ) {
    errors
  }
}
```

All attributes are mandatory, except for the following exception regarding `newLine` and `oldLine`:

| type of line we comment on | newLine, oldLine explained |
| ------ | ------ |
| added line (right-hand-side of the diff) | We only submit `newLine` |
| removed line (left-hand-side of the diff) | We only submit `oldLine` |
| unchanged line | Both `newLine` and `oldLine` are **required**. If the unchanged line has a different index on each side of the diff, these attributes need to [reflect that different index](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/340#track-changed-lines-on-the-diff). |

#### Representing the new comment in VS Code

The `createDiffNote` mutation gives us only the new note as a response. But we need the full `discussion` response because only the discussion contains `replyId` attribute that allows us to submit replies.

In other words, without knowing the `replyId`, we can create a new thread, but the user can't reply to that thread.

The only way how we can get it now is to ask for **all discussions on MR** and filter out the one that contains our new note.

### Links / references",4
81036147,2021-03-16 17:05:56.897,MR Review: Introduce global MR cache,"### Problem to solve

When we submit a new comment on the diff, we need to calculate `newLine` and `oldLine` position. The trickiest scenario is when we comment on an unchanged line and we need to calculate the `newLine` and `oldLine` (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/340#track-changed-lines-on-the-diff). 

We currently can't get all information we need because there is a disconnect between the data available to the `MrItemModel` and the code diff

- `MrItemModel` - we have all the API responses for MR, Discussions and MR Diff (version)
- code diff (VS Code Diff view) - we have only the URI and what we can put into `query` parameter

When we create a new comment (new `CommentThread`) the **only** information available to us is the URI.

We need access to **much more MR information** when we create a new comment.

#### URI example

```
""gl-review:/src/commands/mr_discussion_commands.ts?%7B%22commit%22%3A%2265d828eb07558c8dfe03da797f6778fc18eece8b%22%2C%22workspacePath%22%3A%22%2FUsers%2Ftomas%2Fworkspace%2Ftest-projects%2Fgitlab-vscode-extension-TEST%22%2C%22projectId%22%3A5261717%7D""
```

The cryptical `query` string is encoded JSON:

```json
{
    ""commit"": ""65d828eb07558c8dfe03da797f6778fc18eece8b"",
    ""workspacePath"": ""/Users/tomas/workspace/test-projects/gitlab-vscode-extension-TEST"",
    ""projectId"": 5261717
}
```

#### Why more information?

This is the full query to create a new note (notice the input):

```graphql
mutation CreateDiffNoteNonChanged {
  createDiffNote(
    input: {
      noteableId: ""gid://gitlab/MergeRequest/87196674""
      body: ""new note""
      position: {
        baseSha: ""5e6dffa282c5129aa67cd227a0429be21bfdaf80""
        headSha: ""a2616e0fea06c8b5188e4064a76d623afbf97b0c""
        startSha: ""5e6dffa282c5129aa67cd227a0429be21bfdaf80""
        paths: { oldPath: ""test.js"", newPath: ""test.ts"" }
        newLine: 8
        oldLine: 8
      }
    }
  ) {
    errors
  }
}
```

We could still put most of the information into the URL. The only information that would be missing is the lines.

### Proposal

We can introduce a cache, through which we'll be able to retrieve all necessary MR information. Each MR is going to be uniquely identified by `workspaceFolder` (i.e. the local git repository) and `mergeRequest.id` the database numerical ID that is unique for GitLab instance.

The trickiest part of this cache is going to be designing the lifecycle of the cached MR (i.e. when will the cache get invalidated). Currently, we fetch all issues and MRs when the user triggers the `GitLab: Refresh Sidebar` command. (that would equal to cache invalidation).

### Further details

Sketch of how this cache could look like is implemented in the POC (#293) branch [`293-new-comments-poc`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/293-new-comments-poc) (`MrRepository`)

### Links / references",2
81033227,2021-03-16 16:24:56.101,MR Review: add commenting ranges,"### Problem to solve

This issue implements logic related to tracking which lines in the diff have been added/removed/unchanged. This feature needs to be behind a feature flag because we'll implement submitting new comments in a subsequent issue.

#### Commenting ranges

To be able to create new comments (not replies to a thread) we need to create a [`CommentingRangeProvider`](https://code.visualstudio.com/api/references/vscode-api#CommentingRangeProvider). We implement a function that receives a file URI and returns all the lines that the user can comment on.

Without these ranges, the user can only respond to existing comments (#339).

### Proposal

We'll need to use the textual diff that we retrieve from the [MR Diff version API endpoint](https://docs.gitlab.com/ee/api/merge_requests.html#get-a-single-mr-diff-version).

```json
{
  ""old_path"": ""new_file.ts"",
  ""new_path"": ""new_file.ts"",
  ""a_mode"": ""0"",
  ""b_mode"": ""100644"",
  ""new_file"": true,
  ""renamed_file"": false,
  ""deleted_file"": false,
  ""diff"": ""@@ -0,0 +1,3 @@\n+export class NewFile{\n+    private property: string;\n+}\n""
}
```

We'll have to praise the `diff` property to find all changed lines.

### Further details

There is a follow up issue that might have to build on the logic implemented here: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/344

Example:

| no ranges | with ranges |
| ------ | ------ |
| ![gitlab_comment_thread_test_ts___197____gitlab-vscode-extension](/uploads/68d82d72b633a1cd187b1dbbb1973363/gitlab_comment_thread_test_ts___197____gitlab-vscode-extension.png) | ![_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST](/uploads/f64380715c20a6a230e17dd8c95f00ce/_Extension_Development_Host__-_gitlab_comment_thread_test_ts___197____gitlab-vscode-extension-TEST.png) |

### Links / references",2
81028861,2021-03-16 15:27:01.346,MR Review: Respond to a diff thread,"

### Problem to solve

The extension shows us comment threads on the diff, but doesn't allow us to comment in the thread. This issue is to enable and implement responses to diff threads.

![index_md___56749____gitlab](/uploads/14cdcc1b9d790da59ddc3bb36e119c3b/index_md___56749____gitlab.png)

### Proposal

1. [Enable responses](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/d1d744624080dea35d6a5d61b28239aafb67747a/src/review/gitlab_comment_thread.ts#L50)
1. Extend the [`createNote` method](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/d1d744624080dea35d6a5d61b28239aafb67747a/src/gitlab/gitlab_new_service.ts#L532-538) to return notes (with positions), instead of `void`
1. Implement `reply()` function on the [`gitlab_comment_thread`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/d1d744624080dea35d6a5d61b28239aafb67747a/src/review/gitlab_comment_thread.ts)
1. Add a `Create comment now` command and add it to the [`comments/commentThread/context` menu](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/e09ab184e876b79f7648865c4e18272ec1802a98/package.json#L240)

### Further details

Example:

![respond-example](/uploads/7c71d116f0d4f48e286e1d418694e1d2/respond-example.mp4)

This feature is implemented (not production-ready at all) in the POC (#293) branch [`293-new-comments-poc`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/293-new-comments-poc)

### Links / references",2
80124523,2021-03-02 21:21:19.707,Error 400 when on a branch that has special chars,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.

If you are facing issues around configuring Token from your GitLab.com account, see the list of already addressed Token related issues:

https://gitlab.com/gitlab-org/gitlab-vscode-extension/issues?scope=all&utf8=%E2%9C%93&state=closed&label_name[]=token-issue
--->

### Summary

<!-- Summarize the bug encountered concisely -->
When in a branch with a special name the extensions simply goes haywire. It keeps trying to communicate with Gitlab but keeps receiving a ton of 400 errors.

### Steps to reproduce

<!-- How one can reproduce the issue - this is very important -->
Right now I'm in a branch called `feature/ch38/add-fn-para-criar-novo-usuário` (which is in Portuguese and has an accent in one of the words).

- Moving to a branch that has special chars already does the job

### What is the current *bug* behavior?

<!-- What actually happens -->
Told above.

### What is the expected *correct* behavior?

<!-- What you should see instead -->
It should work as any other branch, regardless of the name.

### Relevant logs and/or screenshots

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->

<details>

```

Found https://gitlab.com in the PAT list and git remotes, using it as the instanceUrl
{
  ""userMessage"": ""Failed to parse GitLab API response"",
  ""errorMessage"": ""Unexpected token < in JSON at position 0"",
  ""stack"": [
    ""SyntaxError: Unexpected token < in JSON at position 0"",
    ""\tat JSON.parse (<anonymous>)"",
    ""\tat Object.config.transform (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/out/src/gitlab_service.js:63:36)"",
    ""\tat /home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request-promise-core/lib/plumbing.js:94:46"",
    ""\tat Promise.cancellationExecute [as _execute] (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/debuggability.js:406:9)"",
    ""\tat Promise._resolveFromExecutor (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/promise.js:518:18)"",
    ""\tat new Promise (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/promise.js:103:10)"",
    ""\tat Request.plumbing.callback (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request-promise-core/lib/plumbing.js:93:18)"",
    ""\tat Request.RP$callback [as _callback] (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request-promise-core/lib/plumbing.js:46:31)"",
    ""\tat Request.self.callback (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request/request.js:185:22)"",
    ""\tat Request.emit (events.js:315:20)"",
    ""\tat Request.<anonymous> (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request/request.js:1154:10)"",
    ""\tat Request.emit (events.js:315:20)"",
    ""\tat IncomingMessage.<anonymous> (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request/request.js:1076:12)"",
    ""\tat Object.onceWrapper (events.js:421:28)"",
    ""\tat IncomingMessage.emit (events.js:327:22)"",
    ""\tat endReadableNT (_stream_readable.js:1220:12)"",
    ""\tat processTicksAndRejections (internal/process/task_queues.js:84:21)""
  ],
  ""additionalInfo"": ""Response body: <!DOCTYPE html>\n<html>\n<head>\n  <meta content=\""width=device-width, initial-scale=1, maximum-scale=1\"" name=\""viewport\"">\n  <title>400 Bad Request</title>\n  <style>...</style>\n</head>\n\n<body>\n  <h1>\n    <img src=\""...\"" alt=\""GitLab Logo\"" /><br />\n    400\n  </h1>\n  <div class=\""container\"">\n    <h3>Your browser sent an invalid request.</h3>\n    <hr />\n    <p>Please contact your GitLab administrator if you think this is a mistake.</p>\n  </div>\n</body>\n</html>\n<html>\n\nRequest URL: https://gitlab.com/api/v4/projects/.../pipelines?ref=feature/ch38/add-fn-para-criar-novo-usuário""
}
400 - ""<!DOCTYPE html>\n<html>\n<head>\n  <meta content=\""width=device-width, initial-scale=1, maximum-scale=1\"" name=\""viewport\"">\n  <title>400 Bad Request</title>\n  <style>\n    body {\n      color: #666;\n      text-align: center;\n      font-family: \""Helvetica Neue\"", Helvetica, Arial, sans-serif;\n      margin: auto;\n      font-size: 14px;\n    }\n\n    h1 {\n      font-size: 56px;\n      line-height: 100px;\n      font-weight: normal;\n      color: #456;\n    }\n\n    h2 {\n      font-size: 24px;\n      color: #666;\n      line-height: 1.5em;\n    }\n\n    h3 {\n      color: #456;\n      font-size: 20px;\n      font-weight: normal;\n      line-height: 28px;\n    }\n\n    hr {\n      max-width: 800px;\n      margin: 18px auto;\n      border: 0;\n      border-top: 1px solid #EEE;\n      border-bottom: 1px solid white;\n    }\n\n    img {\n      max-width: 40vw;\n    }\n\n    .container {\n      margin: auto 20px;\n    }\n  </style>\n</head>\n\n<body>\n  <h1>\n    <img src=\""...\"" alt=\""GitLab Logo\"" /><br />\n    400\n  </h1>\n  <div class=\""container\"">\n    <h3>Your browser sent an invalid request.</h3>\n    <hr />\n    <p>Please contact your GitLab administrator if you think this is a mistake.</p>\n  </div>\n</body>\n</html>\n<html>\n""
StatusCodeError: 400 - ""<!DOCTYPE html>\n<html>\n<head>\n  <meta content=\""width=device-width, initial-scale=1, maximum-scale=1\"" name=\""viewport\"">\n  <title>400 Bad Request</title>\n  <style>... </style>\n</head>\n\n<body>\n  <h1>\n    <img src=\""...\"" alt=\""GitLab Logo\"" /><br />\n    400\n  </h1>\n  <div class=\""container\"">\n    <h3>Your browser sent an invalid request.</h3>\n    <hr />\n    <p>Please contact your GitLab administrator if you think this is a mistake.</p>\n  </div>\n</body>\n</html>\n<html>\n""
	at new StatusCodeError (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request-promise-core/lib/errors.js:32:15)
	at /home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/request-promise-core/lib/plumbing.js:97:41
	at tryCatcher (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/util.js:16:23)
	at Promise._settlePromiseFromHandler (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/promise.js:547:31)
	at Promise._settlePromise (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/promise.js:604:18)
	at Promise._settlePromiseCtx (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/promise.js:641:10)
	at _drainQueueStep (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/async.js:97:12)
	at _drainQueue (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/async.js:86:9)
	at Async._drainQueues (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/async.js:102:5)
	at Immediate.Async.drainQueues [as _onImmediate] (/home/johnny/.vscode/extensions/gitlab.gitlab-workflow-3.13.0/node_modules/bluebird/js/release/async.js:15:14)
	at processImmediate (internal/timers.js:456:21)

```

</details>

### Possible fixes

<!-- If you can, link to the line of code that might be responsible for the problem -->

- Possibly it's lacking url-encode the branch name before sending the message",1
79651105,2021-02-23 16:47:16.734,Remote Code Execution after cloning a malicious repository [ VSCode Extension ],"**[HackerOne report #1094381](https://hackerone.com/reports/1094381)** by `rapt00r` on 2021-02-04, assigned to @dcouture:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

###  Summary  
Hi there! I've found a critical vulnerability on the VSCode Extension `gitlab` that allows an attacker to execute malicious binary on the victim's machine after they cloning a repository.

###  Description  
The vulnerability occurs because the gitlab extension for VSCode doesn't specify where the binary `git.exe` on the windows, must be called. This will make the Windows search for the `git.exe` inside of the current directory after cloning a repository, allowing a custom git.exe binary to be executed after the clone.

#####  Why this happen?  
When a user execute a command, Windows first will check on the current directory, then it's will verify each path in the `%PATH%` variable and finally checks the system locations, for example `%WINDIR%`.

By knowing this, when a user clone a new repository, Windows will check if the `git.exe` file exists on the current directory (cloned repository) and if found, it will be executed. As the malicious repository have the `git.exe` file and any 'allowed paths' are not defined, Windows will check the repository and will execute, allowing to execute our binaries.

###  Steps to Reproduce  
1. Create a new Repository.  
2. Rename a Window's binary to `git.exe` and upload to the repository (in this example, I used the calculator.exe)  
3. Open the VSCode and install the gitlab extension.  
4. Clone the repository  
5. The binary will be executed after the clone.

####  Demo  
1. Creating a new repository:  
![gitlab-00.png](https://h1.sec.gitlab.net/a/8bd8c78a-d94f-4f07-88c1-33effc758a21/gitlab-00.png)

2. Upload the calculator binary inside of the repository (remember to renamee it to git.exe before upload):  
![gitlab-04.png](https://h1.sec.gitlab.net/a/4ad59212-4e14-4c0c-9ff5-1a0b1370f29f/gitlab-04.png)

3.  Clone the  repository (can be via VSCode directly too):  
![gitlab-05.png](https://h1.sec.gitlab.net/a/68638e99-c1ec-4bc3-996e-5a32d8ac4d8d/gitlab-05.png)

4. Open the repository in the VSCode:  
![gitlab-07.png](https://h1.sec.gitlab.net/a/7af90f90-7316-4912-98bb-4ba9b1d2a458/gitlab-07.png)

5. The calculator binary will be executed:  
![gitlab-08.png](https://h1.sec.gitlab.net/a/ea2b0d7e-09a3-45b3-b76c-908ba118c79d/gitlab-08.png)

Video PoC:  
![gitlab-rce.mp4](https://h1.sec.gitlab.net/a/a40b55d6-9f04-46f9-8882-fca1c1e6bf47/gitlab-rce.mp4)

####  Impact

Attackers can run malicious binary on user's machine that cloned the malicious repository

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [gitlab-00.png](https://h1.sec.gitlab.net/a/8bd8c78a-d94f-4f07-88c1-33effc758a21/gitlab-00.png)
* [gitlab-05.png](https://h1.sec.gitlab.net/a/68638e99-c1ec-4bc3-996e-5a32d8ac4d8d/gitlab-05.png)
* [gitlab-04.png](https://h1.sec.gitlab.net/a/4ad59212-4e14-4c0c-9ff5-1a0b1370f29f/gitlab-04.png)
* [gitlab-08.png](https://h1.sec.gitlab.net/a/ea2b0d7e-09a3-45b3-b76c-908ba118c79d/gitlab-08.png)
* [gitlab-07.png](https://h1.sec.gitlab.net/a/7af90f90-7316-4912-98bb-4ba9b1d2a458/gitlab-07.png)
* [gitlab-rce.mp4](https://h1.sec.gitlab.net/a/a40b55d6-9f04-46f9-8882-fca1c1e6bf47/gitlab-rce.mp4)

## How To Reproduce

Please add [reproducibility information] to this section:

1.
1.
1.

[reproducibility information]: https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues",2
79060575,2021-02-14 22:49:27.795,Subpath in self-hosted gitlab is not used,"### Summary
When self-hosted gitlab is in a subpath (such as https://my.domain/gitlab/) all results return ""Project failed to load"" with a 404 error.

Initially discussed in #297 but you asked me to open as its own ticket.

### Steps to reproduce
* Install self-hosted gitlab in a subpath like https://my.domain/gitlab/
* Configure `gitlab.instanceUrl` to be `https://my.domain/gitlab/`
* Set PAT
* Open the Gitlab Workflow tab

### What is the current *bug* behavior?
* ""Issues and merge requests"" shows ""Project failed to load""
* ""For Current Branch"" shows ""Error occurred, please try to refresh""
* Error 404 logged in console
* Looking in fiddler, see a request being made to https://my.domain/api/graphql

### What is the expected *correct* behavior?
* Proper values, not error messages.
* API query should be sent to https://my.domain/gitlab/api/graphql instead of https://my.domain/api/graphql 

### Relevant logs and/or screenshots
output of `git remote show origin`:
```
* remote origin
  Fetch URL: https://my.domain/gitlab/myname/keyboard.git
  Push  URL: https://my.domain/gitlab/myname/keyboard.git
  HEAD branch: master
  Remote branch:
    master tracked
```

Configuration file:
```
{
    ""gitlab.instanceUrl"": ""https://my.domain/gitlab/"",
}
```

In the log:
```
GraphQL Error (Code: 404): {""response"":{""error"":""<html>\r\n<head><title>404 Not Found</title></head>\r\n<body>\r\n<center><h1>404 Not Found</h1></center>\r\n<hr><center>nginx/1.18.0 (Ubuntu)</center>\r\n</body>\r\n</html>\r\n"",""status"":404},""request"":{""query"":""\n  query GetProject($projectPath: ID!) {\n    project(fullPath: $projectPath) {\n      id\n      name\n      fullPath\n      webUrl\n      group {\n        id\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""myname/keyboard""}}}
Error: GraphQL Error (Code: 404): {""response"":{""error"":""<html>\r\n<head><title>404 Not Found</title></head>\r\n<body>\r\n<center><h1>404 Not Found</h1></center>\r\n<hr><center>nginx/1.18.0 (Ubuntu)</center>\r\n</body>\r\n</html>\r\n"",""status"":404},""request"":{""query"":""\n  query GetProject($projectPath: ID!) {\n    project(fullPath: $projectPath) {\n      id\n      name\n      fullPath\n      webUrl\n      group {\n        id\n      }\n    }\n  }\n"",""variables"":{""projectPath"":""myname/keyboard""}}}
	at GraphQLClient.<anonymous> (c:\Users\myname\.vscode\extensions\gitlab.gitlab-workflow-3.12.0\node_modules\graphql-request\dist\index.js:172:35)
	at step (c:\Users\myname\.vscode\extensions\gitlab.gitlab-workflow-3.12.0\node_modules\graphql-request\dist\index.js:63:23)
	at Object.next (c:\Users\myname\.vscode\extensions\gitlab.gitlab-workflow-3.12.0\node_modules\graphql-request\dist\index.js:44:53)
	at fulfilled (c:\Users\myname\.vscode\extensions\gitlab.gitlab-workflow-3.12.0\node_modules\graphql-request\dist\index.js:35:58)
	at processTicksAndRejections (internal/process/task_queues.js:97:5)
{
  ""message"": ""API request failed when trying to get current project because: GraphQL Error (Code: 404): {\""response\"":{\""error\"":\""<html>\\r\\n<head><title>404 Not Found</title></head>\\r\\n<body>\\r\\n<center><h1>404 Not Found</h1></center>\\r\\n<hr><center>nginx/1.18.0 (Ubuntu)</center>\\r\\n</body>\\r\\n</html>\\r\\n\"",\""status\"":404},\""request\"":{\""query\"":\""\\n  query GetProject($projectPath: ID!) {\\n    project(fullPath: $projectPath) {\\n      id\\n      name\\n      fullPath\\n      webUrl\\n      group {\\n        id\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""myname/keyboard\""}}}"",
  ""stack"": [
    ""Error: API request failed when trying to get current project because: GraphQL Error (Code: 404): {\""response\"":{\""error\"":\""<html>\\r\\n<head><title>404 Not Found</title></head>\\r\\n<body>\\r\\n<center><h1>404 Not Found</h1></center>\\r\\n<hr><center>nginx/1.18.0 (Ubuntu)</center>\\r\\n</body>\\r\\n</html>\\r\\n\"",\""status\"":404},\""request\"":{\""query\"":\""\\n  query GetProject($projectPath: ID!) {\\n    project(fullPath: $projectPath) {\\n      id\\n      name\\n      fullPath\\n      webUrl\\n      group {\\n        id\\n      }\\n    }\\n  }\\n\"",\""variables\"":{\""projectPath\"":\""myname/keyboard\""}}}"",
    ""\tat Object.<anonymous> (c:\\Users\\myname\\.vscode\\extensions\\gitlab.gitlab-workflow-3.12.0\\out\\src\\gitlab_service.js:91:19)"",
    ""\tat Generator.throw (<anonymous>)"",
    ""\tat rejected (c:\\Users\\myname\\.vscode\\extensions\\gitlab.gitlab-workflow-3.12.0\\out\\src\\gitlab_service.js:6:65)"",
    ""\tat processTicksAndRejections (internal/process/task_queues.js:97:5)""
  ]
}
```",1
78741410,2021-02-09 18:13:27.892,"MR Review: Resolve discussion, Edit and Delete comment","### Problem to solve

Currently, users can only view comments on MRs. If they want to interact with these comments, they'll have to switch to the web interface.

### Proposal

Implement resolving discussions, editing and deleting comments as described in detail in #269.

#### Resolving/unresolving discussions

![poc-resolve-thread](/uploads/50243d6f171f20f3f2e26e033cf2b5db/poc-resolve-thread.gif)

#### Edit comment

![poc-editing-comments](/uploads/7b16d501872a1734ab58d9e3fec50b2e/poc-editing-comments.gif)

#### Delete comment

![delete-confirmation](/uploads/5eb7158f06c0361e45141c6f2f31c232/delete-confirmation.gif)

#### Stretch: Open the comment in the browser

![poc-comment-on-the-web](/uploads/0d9652783c487deefc61ed2c1727e98a/poc-comment-on-the-web.gif)

### Further details

The [""POC Result"" section of the POC issue](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/269#poc-result) provides a detailed technical description of the features
### Links / references",3
78361685,2021-02-03 13:52:24.669,Deprecate custom query with pipeline id,"### Problem to solve

Custom queries are used in the sidebar view (e.g. showing ""MRs assigned to me""). Custom query is a VS Code configuration object.

One of the custom query properties is `pipelineId` and it's defined as follows:

```json
{
  ""pipelineId"": {
    ""type"": ""number | string"",
    ""description"": ""Returns vulnerabilities belonging to specified pipeline. \""branch\"" returns vulnerabilities belonging to latest pipeline of the current branch. Works only with vulnerabilities""
  }
}
```

The `branch` part has been broken for at least 3 months, probably more (I found that when working on https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/174).

And I don't see users hardcoding a numeric `pipelineId` into their VS Code config.


### Proposal

Remove this option altogether.

### Further details


### Links / references",1
78196311,2021-02-01 11:04:18.911,"Error loading Merge Requests -  ""Cannot read property 'startsWith' of null""","<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.

If you are facing issues around configuring Token from your GitLab.com account, see the list of already addressed Token related issues:

https://gitlab.com/gitlab-org/gitlab-vscode-extension/issues?scope=all&utf8=%E2%9C%93&state=closed&label_name[]=token-issue
--->

### Summary

<!-- Summarize the bug encountered concisely -->
When trying to load MRs from a private GitLab I'm getting the error ""Cannot read property 'startsWith' of null"".
However, I can see issues for example.

### Steps to reproduce

<!-- How one can reproduce the issue - this is very important -->
I'm not sure but all I've done is install the extension, connect it to a privat gitlab (where we use SSH for connection), set the Personal Access Token, and add the instanceUrl, remoteName and pipelineGitRemoteName as it is reached via SSH and there is a known issue with that. (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/79#note_495879565)


### What is the current *bug* behavior?

<!-- What actually happens -->
I was able to see MRs at first after setting the Extension up. However, I had to set ""gitlab.instanceUrl""
, ""gitlab.remoteName"" and ""gitlab.pipelineGitRemoteName"" for it to work.
The next time I wanted to see a MR it didn't work giving me the error from the title with the following behavior:
When selecting ""Issues assigned to me"" in the extension tab, I can see the expected issues, when I select ""Merge requests assigned to me"" or ""All project merge requests"" I get the ""Cannot read property 'startsWith' of null"" error and I don't see any MRs.



### What is the expected *correct* behavior?

<!-- What you should see instead -->
I should be able to see MRs assigned to me or all MRs depending on which tab I'm opening.

### Relevant logs and/or screenshots

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->
I'm only getting the VS Code ""Cannot read property 'startsWith' of null"" Error without any further information.

### Possible fixes

<!-- If you can, link to the line of code that might be responsible for the problem -->",1
77691377,2021-01-22 15:01:42.258,Fetching issue/merge request description not working in VS Code Insiders,"### Summary

Fetching the issue/merge request description has stopped working in the last few weeks.

### Steps to reproduce

1. Open *GitLab Workflow* sidebar.
1. Expand a dropdown to reveal an issue or merge request.
1. Expand the issue or merge request options.
1. Click ""Description"".
1. Observe a new editor launch saying that it's ""Fetching issuable details and discussions. This may take a while.""
1. Observe that the editor never populates with the issuable details and discussions.

### What is the current *bug* behavior?

Description editor never populates with details.

### What is the expected *correct* behavior?

Description editor should show issue or merge request details.

### Relevant info and screenshots

The editor simply shows this indefinitely:

![image](/uploads/12d4f6665d02745e9cb636bf6cead63d/image.png)

- I'm currently running version v3.10.0 of the *GitLab Workflow* extension, but I believe this issue started happening a few releases prior.
- In previous versions, I was able to switch to a different editor tab and then switch back to the *Description* tab and the issue/merge request details would then populate.

### VSCode version information

- Version: 1.53.0-insider (user setup)
- Commit: 4f2341834e646360e603953b62bf6c6020b07a29
- Date: 2021-01-22T08:57:22.447Z
- Electron: 11.2.0
- Chrome: 87.0.4280.141
- Node.js: 12.18.3
- V8: 8.7.220.31-electron.0
- OS: Windows_NT x64 10.0.16299",1
77619224,2021-01-21 15:35:23.441,MR Review: Relative links in comments don't work.,"### Summary

When we receive comments from the Graph QL endpoint, they might contain relative URLs. VS Code needs to have access to full URLs. For example

This comment https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/156#note_482777098

contains link

```md
![_Extension_Development_Host__-_gitlab_new_service_ts___gitlab-vscode-extension-TEST](/uploads/a262ea24dc5da36de0fb49aca7622881/_Extension_Development_Host__-_gitlab_new_service_ts___gitlab-vscode-extension-TEST.png)
```

and in VS Code it looks like:

![current_branch_js___156____gitlab-vscode-extension](/uploads/0db5eb29c8c7437a664fb2ca268b3b14/current_branch_js___156____gitlab-vscode-extension.png)

### Steps to reproduce

Open https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/156#note_482777098 in VS Code. You can find the MR by adding this [custom query](https://gitlab.com/gitlab-org/gitlab-vscode-extension#custom-queries) to you VS Code `settings.json`.

```json
    {
      ""name"": ""Merged MRs assigned to viktomas"",
      ""type"": ""merge_requests"",
      ""noItemText"": ""There is no issue assigned to viktomas."",
      ""state"": ""merged"",
      ""assignee"": ""viktomas""
    },
```

### What is the current *bug* behavior?

VS Code displays links and images incorrectly.

### What is the expected *correct* behavior?

The extension is going to prepend the instance URL to each relative link.",1
77216120,2021-01-14 10:42:13.775,Support Multiple Accounts per GitLab Instance,"### Problem to solve

As a Freelancer, I want to be able to set the GitLab Personal Token per Git Repository / Project, so I can work with different accounts on GitLab.com

### Proposal

In general within Git it's possible to specify Identity Files specifying which ssh key to use. These can referenced per repo in the repos git config so I'm able to use different ssh keys for the same host.

It would be great to have a similar functionality for the Gitlab Workflow Extension, so it's possible to set e.g. a Company and Private Accounts Secret Token for gitlab.com

### Links / references",2
76936742,2021-01-08 16:38:36.365,MR review: new comments and reviews POC,"### Problem to solve

This issue is a continuation of the #269 investigation. The #269 investigated how te work with existing comments and this POC is validating implementation for creating new comments and managing reviews.

We had a few issues when integrating with the GitLab API(https://gitlab.com/gitlab-org/gitlab/-/issues/281143, https://gitlab.com/gitlab-org/gitlab/-/issues/282476, https://gitlab.com/gitlab-org/gitlab/-/issues/282481). Part of the validation is going to be checking that all GitLab endpoints are now working as expected.

### Proposal

Create POC that answers the following questions:


- How are we going to create a comment? What's going to be the VS Code behaviour if we fail to send the comment (on the web the text area remembers the comment)
- How are we going to contribute to a thread?
- How can we represent MR review in progress? What is the API for showing unsubmitted reviews?
- How can we edit and delete existing comments?
- What happens when we submit a review that is out of date? In other words: somebody committed changes since we started the review.

### Result

![new_comments](/uploads/42fd96a62b757e3356cf8e3a0becbc35/new_comments.mp4)

Try the POC extension: [gitlab-workflow-4.0.0.vsix](/uploads/2658d339a155a2c8513125a82dcbad2a/gitlab-workflow-4.0.0.vsix)

The POC is implemented in a branch: [`293-new-comments-poc`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/293-new-comments-poc)

#### TL;DR

Creating new comments is possible, however, there are several API deficiencies[1][2] that will make extension implementation harder requiring several workarounds. Fixing the deficiencies would simplify the implementation a lot.

#### Overview of the work:

- [MR Review: Respond to a diff thread](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/339)
  - relatively simple because we don't need to pass in a position for the new note, we'll just send `discussion.replyId` with the request to explain what we are responding to
  - *the only issue that can't be made simpler by fixing the GraphQL API*
- [MR Review: add commenting ranges](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/340)
  - We need to compute what lines have been added, based on text diff hunks that we get from the API.
  - We then use this information to show commenting ranges (gutters) that allow users to comment on certain lines.
- [MR Review: track changed lines on the diff](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/344)
  - This issue is to track the line index of an unchanged line. The unchanged line can be ""pushed down"" or ""pulled up"" relative to the new version of the diff and we must track that difference to be able to submit a comment on unchanged line.
  - There are some unnecessary constraints introduced by the API that make it extra hard for us the create notes on unchanged lines[1]. *If we fix [1], we don't have to implement this issue.*
- [MR Review: Introduce global MR cache](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/341)
  - thanks to [1] and [2] we need much more information for creating new notes than what can fit in the URI (which VS Code uses to communicate between the extension and the diff view).
  - we need to introduce a global cache so we can easily get all the MR information just by knowing its ID
  - *It would be possible to get away without implementing this issue if [1] and [2] get fixed, but I think it's still worth simplifying the way we handle MR information (GitHub Pull Request does something similar). But if [1][2] get fixed, this is not a blocker.*
- [MR Review: create a new comment on the diff](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/342)
  - This is the final issue, it's going to be quite a lot of effort and has got weight of `4`
  - We'll have to implement a workaround for [2]

#### Dependencies

Only the last issue ([MR Review: create a new comment on the diff](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/342)) is dependent on all the previous issues.

```mermaid
graph LR
A[""Respond to a diff thread""] --> D[""create a new comment on the diff""]
B[""add commenting ranges""] --> E[""track changed lines on the diff""]
E --> D
C[""Introduce global MR cache""] --> D
```

[1]: [GraphQL `createDiffNote` forces clients to compute redundant information](https://gitlab.com/gitlab-org/gitlab/-/issues/325161)

[2]: [GraphQL `createDiffNote` mutation doesn't fully support interactive clients](https://gitlab.com/gitlab-org/gitlab/-/issues/325155)",2
76107661,2020-12-15 23:22:24.728,Add MR's I'm Reviewing to Sidebar Lists,"## Problem to Solve

[Merge Request Reviewers](https://gitlab.com/groups/gitlab-org/-/epics/5072) was added to GitLab. This allows people to be placed in the `Reviewers` role for Merge Requests. If you're a `Reviewer` those items won't be surfaced in VS Code.

## Proposal

We should add a `Merge Requests I'm Reviewing` filter to the sidebar in VS Code that retrieves a list of MR's where I'm listed as a Reviewer.

## Technical details

- We define default queries (that show in the sidebar) in [package.json](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/658a0c8bccc425bd046b5de4d1ef78a3fb7f2250/package.json#L483-489)
- The `CustomQuery` type is defined in [`custom_query.ts`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/a2b3f881f8de9c30bce5e423b51506a9935d6188/src%2Fgitlab%2Fcustom_query.ts#L2-3)
- Same way as we use [`assignee_username`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/a2b3f881f8de9c30bce5e423b51506a9935d6188/src%2Fgitlab_service.ts#L298) we would want to use `reviewer_username`.

## Possible improvements to the existing code

- Use [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams) or similar method to replace the current `queryString += '&key=value'` mutations that the  `gitlab_service.ts`.`fetchIssuables()` method uses.
- Increase the test coverage for the same `fetchIssuables()` method.
  - There are a few happy path integration test scenarios in `test/integration/tree_view.test.js`
  - We could potentially introduce a Jest uni test because there is a lot of logic branching in the method.",2
76072720,2020-12-15 09:49:42.795,Use windows CI runner to run integration tests,"### Problem to solve

At GitLab, using Windows for development is [strictly prohibited](https://about.gitlab.com/handbook/business-ops/team-member-enablement/onboarding-access-requests/#laptop-configurations). The extension is heavily working with the host machine file system. But the extension is rarely (if ever) tested on non-POSIX system before the release.

In some cases, this development process results in bugs (e.g. #284) that could be caught by running the integration tests on Windows.


### Proposal

Dog feed our [shared Windows runners](https://about.gitlab.com/blog/2020/01/21/windows-shared-runner-beta/).

### Further details

We would introduce another CI task similar to the `test-integration` but run by a windows CI runner.

```yaml
test-integration:
  stage: test
  variables:
    DISPLAY: ':99.0'
  script:
    - apt-get update
    - apt-get install -y xvfb libxtst6 libnss3 libgtk-3-0 libxss1 libasound2 libsecret-1-0 git
    - npm ci
    - echo $DISPLAY
    - /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
    - npm run test-integration
```

### Links / references",2
75817200,2020-12-09 09:18:19.790,Use welcome view when the extension can't show TreeView,"### Problem to solve

There are several scenarios when the extension can't do any useful work:

- New VS Code window (no workspace is open)
- None of the open workspaces contains a configured GitLab project
- The personal access token hasn't been set up
- There workspace folder doesn't have initialized git repository #321

For example, attempt to use the extension when there is no open project now results in an error message:

![image](/uploads/18b16f548b566c4e715efec3cc205bfb/image.png)

### Proposal

Utilise the [Welcome view](https://code.visualstudio.com/api/references/contribution-points#contributes.viewsWelcome) available in for VS Code extensions:

![poc-welcome](/uploads/e7eb40ec6996d372afa767cb7ae902b5/poc-welcome.gif)

#### Scenario 1: No token

```txt
Hey. Welcome to the GitLab Workflow extension. It seems that you have not yet set up your access token.
If you use GitLab.com, click [here](https://gitlab.com/profile/personal_access_tokens). If you have a self-managed GitLab, then: 
1. Go to 'Settings'
2. Click 'Access Tokens' on the left navigation menu
3. Click on 'Add a personal access token'
Now you can set your token by clicking on the following button
[Set Personal Access Token](command:gl.setToken)
To learn more, please [read our docs](https://gitlab.com/gitlab-org/gitlab-vscode-extension#setup).
```

- [ ] mention that the token needs `read_user` and `api` scopes to fix https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/230

**Once this scenario is implemented, we should not show the ""add token"" info message during every extension startup. It was bothering users: #279**

#### Scenario 2: No GitLab project

```txt
It seems like your current workspace doesn't contain a GitLab project (or the project has been moved).
```

#### Scenario 3: No open project

```txt
In order to use the GitLab Worfklow extension, please open a folder containing a GitLab project.
[Open GitLab project folder](command:vscode.open)
```

### Further details

There is a small POC implemented in [`welcome-poc` branch](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/compare/main...welcome-poc).

### Examples

| extension | screenshot |
| ------ | ------ |
| source control (no open workspace) | ![Welcome](/uploads/676ed2698d424024945391d4e342834c/Welcome.png) |
| source control (no git repository) | ![Welcome___Music](/uploads/a9d6fd9928ba19e51e4038a14621d256/Welcome___Music.png) |
| debugger | ![Welcome___Music](/uploads/36ca0ffadab097b21ae3b32bf09f12be/Welcome___Music.png) |",2
75629820,2020-12-04 17:23:38.430,Unpubished Branch on Remote generates Error,"When a branch exists locally, but has not been published to GitLab there is an error in the logs:

```
Command failed with exit code 1: git config --get branch.phikai-code-review-dec-pi-update.merge
Error: Command failed with exit code 1: git config --get branch.phikai-code-review-dec-pi-update.merge
	at makeError (/Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.6.2/node_modules/execa/lib/error.js:59:11)
	at handlePromise (/Users/phikai/.vscode-insiders/extensions/gitlab.gitlab-workflow-3.6.2/node_modules/execa/index.js:114:26)
	at runMicrotasks (<anonymous>)
	at processTicksAndRejections (internal/process/task_queues.js:94:5)
```",1
75498628,2020-12-02 16:36:50.115,MR Review: Show change type for each changed file,"### Problem to solve

This is a follow-up to #263. Currently, we are indicating the type of git change by prepending `[added]`, `[deleted]`, `[renamed]` to the item description.

![_Extension_Development_Host__-_Welcome___gitlab-vscode-extension-TEST](/uploads/79eaf122b3480c71793ca31084ef6c52/_Extension_Development_Host__-_Welcome___gitlab-vscode-extension-TEST.png)

But once the `FileDecoration`s are [generally available in the next VS Code release](https://github.com/microsoft/vscode/issues/54938), we should use them instead:

![mr_item_ts___gitlab-vscode-extension](/uploads/a362e564c6ef5b289aa0194cbc729e35/mr_item_ts___gitlab-vscode-extension.png)

### Proposal

Implement the `FileDecorationProvider` once at least 90% of the users are on the latest version (`^1.52.0`).

### Further details

I looked into the logs today (2020-12-02) and I saw that roughly 90% of extension requests on `gitlab.com` are made by the latest VS Code version. [Today is 21 days since the latest VS Code version has been released](https://github.com/microsoft/vscode/releases/tag/1.51.1).

These numbers can be checked in the logs https://log.gprd.gitlab.net/ (only GitLab team members).

- index: `pubsub-workhorse-inf-gprd-*`
- query: `json.user_agent : ""vs-code-gitlab-workflow/3.6.2 VSCode/""` AND NOT `json.user_agent : ""vs-code-gitlab-workflow/3.6.2 VSCode/1.51.1""` (replace versions by the latest)

### Links / references",1
75467458,2020-12-02 07:39:12.650,Multi-root workspace with a non-GitLab project doesn't work: Error: 404 Project Not Found,"<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.

If you are facing issues around configuring Token from your GitLab.com account, see the list of already addressed Token related issues:

https://gitlab.com/gitlab-org/gitlab-vscode-extension/issues?scope=all&utf8=%E2%9C%93&state=closed&label_name[]=token-issue
--->

### Summary

<!-- Summarize the bug encountered concisely -->

Ext is going to be useless if project could not be fetched by API.

### Steps to reproduce

<!-- How one can reproduce the issue - this is very important -->

1. Clone [gitlabhq/terraform-provider-gitlab](https://github.com/gitlabhq/terraform-provider-gitlab) from GitHub to folder on the workstation.
2. Clone [gitlab-org/gitlab-vscode-extension](https://gitlab.com/gitlab-org/gitlab-vscode-extension) from GitLan to folder on the workstation.
3. Add both repos to VS Code and save workspace configuration.
4. Go to GitLab sidebar.
5. Click on **refresh** icon.
6. Gitlab Extension fails with error notification.


Clone git repo with valid git remote url.
Change git remote url to something else.
Go to sidebar and refresh your issues / merge requests.

### What is the current *bug* behavior?

<!-- What actually happens -->

GitLab Ext tries to fetch project info by given group name extracted from git remote url, and fails when project could not found.
API request failed when trying to get current project because: 404 - ""{\""message\"":\""404 Project Not Found\""}""

### What is the expected *correct* behavior?

<!-- What you should see instead -->

Ext shouldn't fail in case if project does not exist by given group name, or added git repo is originally from Github, Bitbucket, etc.

### Relevant logs and/or screenshots

![image](/uploads/ddb7df56f55eed8cd30667e17c98323f/image.png)
![image](/uploads/86b9bcd45c9b0b5c8bcc195838b59559/image.png)

<!-- Logs can be found by running `GitLab: Show extension logs` command (using `cmd+shift+p`) -->

### Possible fixes

<!-- If you can, link to the line of code that might be responsible for the problem -->",1
74332669,2020-11-13 15:56:30.656,MR review: interacting with existing comments - POC,"### Problem to solve

The #243 proof of concept work didn't validate the workflows for creating and updating comments on the MR diff. The VS Code API for creating/editing comments is not documented and so we have to result to try to copy a reference implementation like GitHub pull request extension.

This issue is to create POC that validates the implementation of interacting with existing comments (responding, resolving, deleting, possibly reactions). Creating new comments and reviews is going to be out of scope for this POC.

### Proposal

- Investigate VS Code API's for triggering actions on comments (edit, (un)resolve, delete, report abuse?)
- Implement POC for editing comments.
- Investigate VS Code API's for access control (i.e. only show users actions that are available to them (e.g. only the author can edit the comment).
- validate that the GraphQL queries and mutations are in place
- if time allows, investigate how to implement reactions (is the VS Code reaction API compatible with GitLab?)

### Further details

- Explanation of how the current MR review POC works is here: #243

## POC Result

**TL;DR**: This POC implemented editing and resolving comments, validating the presence of all APIs (both GitLab and VS Code). The only feature that we are not able to implement straight away is emoji reactions.

All code is available in the [`existing-comments-poc`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/existing-comments-poc) branch.

### :white_check_mark: Editing comments

![poc-editing-comments](/uploads/e357e81ea6d25bbf1b882907533b4ff4/poc-editing-comments.gif)

#### GitLab

We'll use `adminNote` permission attribute (see Appendix 2) to decide whether the user can edit a note. GitLab GraphQL API provides an `updateNote` mutation that will change the note body.

#### VS Code

We will add a pencil-shaped icon to the comment title (see Appendix 1). Clicking this icon will change the note mode to `vscode.CommentMode.Editing`. We add two comment context action (see Appendix 1) `Submit` and `Cancel`. Submit will trigger the GraphQL mutation, cancel reverts any changes to the comment text.

We also add the `canAdmin` permission attribute on the comment context so the VS Code can decide whether to show the edit button or not.

#### :warning: Caveyats

- **Comment drafts**: VS Code is not telling us when the comment editing is in progress. We only get notified when the user triggers one of the context actions (submit/cancel). If users close the editor or refresh the MR during editing, they'll lose the draft and we can't do anything about it.

### :heavy_check_mark:  Deleting comments

I've validated the API, but haven't implemented this feature.

Very similar to editing comments without the need to switch comment into editing mode.

We will show a warning message before removing the comment:

```js
const shouldDelete = await vscode.window.showWarningMessage('Delete comment?', { modal: true }, 'Delete');
```

![delete-confirmation](/uploads/2ed0f0ca38dd3771f8999cc8f50a4bea/delete-confirmation.gif)


### :white_check_mark: Resolving/Unresolving discussions

![poc-resolve-thread](/uploads/3ed5bac48d482a3e9318651578da18bc/poc-resolve-thread.gif)

#### GitLab

We'll use `resolvable` permission attribute (see Appendix 2) to decide whether we can let user resolve/unresolve a discussion. GitLab GraphQL API provides a `discussionToggleResolve` mutation that will set the `resolved` attribute.

#### VS Code

We will add a `check` icon to the thread title (see Appendix 1). Clicking this icon will resolve the thread and it will set the thread context to `resolved`. VS Code recognises the context change and it will show `close` icon instead.

#### :warning: Caveyats

- The `cancel` and `check` icons might not accurately show the user what is going to happen. At least they have a tooltip that shows on hover ![Screenshot_2021-02-09_at_17.52.00](/uploads/4909d98d6d09dcf36d08e057543f0367/Screenshot_2021-02-09_at_17.52.00.png)

*[List of all supported icions]([codicon](https://microsoft.github.io/vscode-codicons/dist/codicon.html))*

### :x: Emoji reactions

Implementing reactions is going to be facing issues on both the GitLab and the VS Code side.

#### :x: GitLab

**We don't have a GraphQL endpoint to retrieve reactions for a note.** Issue: https://gitlab.com/gitlab-org/gitlab/-/issues/320963

We do have an endpoint to add or remove a reaction:

```graphql
mutation{
  awardEmojiAdd(input:{awardableId: ""gid://gitlab/DiffNote/447164415"", name: ""tada""}){
    errors
  }
}
```

#### :warning: VS Code

The VS Code extension API is very much GitHub oriented. It is made to support half a dozen predefined reactions, not a full emoji selection as we have at GitLab. You can see that the emoji picker doesn't scale above maybe 10 emojis. Also, each emoji needs to have a PNG icon in the project.

![700face67d864dd78fb55f15934f39cc](/uploads/b2e2c7dadded662f057b976dd1864587/700face67d864dd78fb55f15934f39cc.png)

##### Implementation notes

1. add a `commentHandler`
    ```ts
	commentController.reactionHandler = async (
      comment: vscode.Comment,
      reaction: vscode.CommentReaction,
    ): Promise<void> => {};
	```
1. Each comment can have `reactions`. If they have `count === 0`, they don't show at the bottom of the comment
    ```js
    reactions: [
	  {
		label: '✅',
		iconPath: '$(check)',
		count: 1,
		authorHasReacted: true,
	  },
	],
	```
3. Each [reaction has to have a PNG icon](https://github.com/microsoft/vscode-pull-request-github/blob/29955445c80ae5b3f06b27eb89886d1fd9e91a76/src/common/resources.ts#L13-L25)
otherwise, it shows up as ![e8eecbc1d7624b87bf6f8ec3d951ca69](/uploads/20fc686815c1e0f0de7b2d1a0d155368/e8eecbc1d7624b87bf6f8ec3d951ca69.png)

### :heavy_check_mark: Bonus: Open the comment in a browser

Since we are most likely not going to be adding the ""Report Abuse"" button and also because it might be difficult to introduce reactions from the get-go, I suggested we include `globe` button in the title of each note. When the user clicks this button, VS Code will open the comment permalink in the browser.

![poc-comment-on-the-web](/uploads/d0bdb3deb738236cf6e1803e88574de8/poc-comment-on-the-web.gif)

The POC haven't fully implemented this feature, but all the necessary information (MR URL and note ID) is available.

### Appendix 1: Context menu on comment threads and comments

Extensions can [contribute menus](https://code.visualstudio.com/api/references/contribution-points#contributes.menus). The important menus for the MR Review comments are:

- The comment thread title menu bar - `comments/commentThread/title`
    ![_Extension_Development_Host__-_git_service_ts___173__—_gitlab-vscode-extension-TEST.png](/uploads/46586488ac139956c5b9903c760392c2/24d89816d1e7417abb1151a2d69bcefe.png)

- The comment thread context menu - `comments/commentThread/context`
    ![_Extension_Development_Host__-_git_service_ts___173__—_gitlab-vscode-extension-TEST.png](/uploads/7b80203bf6f4425b46d2282f95de19ee/bc238157fa5e4436a1c6f48abd1d07d6.png)

- The comment title menu bar - `comments/comment/title`
	  ![comments/comment/title](/uploads/9058c42082b8c425218b763eb3bd2682/bdf8aff525fe442c98d046b2e8e9b71b.png)

- The comment context menu - `comments/comment/context`
    ![_Extension_Development_Host__-_git_service_ts___173__—_gitlab-vscode-extension-TEST.png](/uploads/2a78ae8bc120c624d7c3e51a79d80ed0/78dde3979b754cc1bbdb1ddb245ea17c.png)

### Appendix 2: Access control


#### on each note

| Field |	Type | 	Description |
| -- | -- | -- |
|adminNote |	Boolean! |	Indicates the user can perform admin_note on this resource |
|awardEmoji |	Boolean! |	Indicates the user can perform award_emoji on this resource |
|createNote |	Boolean! |	Indicates the user can perform create_note on this resource |
|readNote |	Boolean! |	Indicates the user can perform read_note on this resource |
|repositionNote |	Boolean! |	Indicates the user can perform reposition_note on this resource |
|resolveNote |	Boolean! |	Indicates the user can perform resolve_note on this resource |

#### on merge request

We need the `createNote` value to know whether the user can respond to a discussion.

```
mergeRequest(iid: ""3"") {
  id
  webUrl
  userPermissions{
	createNote
  }
}
```

#### on a discussion

A discussion contains a boolean field `resolvable` indicating whether the discussion can be resolved or not.",2
74331208,2020-11-13 15:32:05.973,Add the ability to show pipelines within vscode,"### Problem to solve

Currently, it's necessary to open the pipeline in the GitLab web interface to learn details about jobs.

We show some rudimentary pipeline information in two places:

|  |  |
| ------ | ------ |
| status bar | ![current_branch_ts___gitlab-vscode-extension](/uploads/62d29acd8ec085d24ffdf8ed9f320ab5/current_branch_ts___gitlab-vscode-extension.png) |
| ""For current branch"" sidebar | ![current_branch_ts___gitlab-vscode-extension](/uploads/b5c0a3a2f2b7e63b7b5210bed72a8190/current_branch_ts___gitlab-vscode-extension.png) |

### Proposal

Extend the tree item in the sidebar to show information about all jobs:

| before | after |
| ------ | ------ |
| ![current_branch_ts___gitlab-vscode-extension](/uploads/efb1e59d5061b4a87146af8e3dba4bd9/current_branch_ts___gitlab-vscode-extension.png) | ![_Extension_Development_Host__-_README_md___test-project](/uploads/e9b76e1e5f5ff1a23694b307ee7d7c22/_Extension_Development_Host__-_README_md___test-project.png) |

### Further details

The API information is available and it should be fairly simple to render the UI as shown above.

This work would provide basis for:

- starting/stopping/retrying jobs #97 
- seeing job logs #423 
- downloading job artifacts #106

The auto-update would be a great follow-up [Auto update ""For Current Branch"" tab in sidebar](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/60)

<details>
<summary>Original description</summary>

Possible duplicate: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/97

### Problem to solve

It's very convenient having the ability to create, view, and comment on issues from within vscode. 

I understand there are a few open issues related to pipelines jobs that I'd assume would be tied into this solution. But I didn't see an open issue specifically requesting this feature, although https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/97 may actually be good enough honestly, if it would work like issues/MRs do.


### Proposal

Curious if embedding `/-/pipelines/$Pipeline_ID` would be an option, similar to what the experience is when clicking an issue and how we can ""View issue and MR details and comments in VS Code""? This would at least allow us to see which job failed, if nothing else. 

### Further details

It looks like @fatihacet did some work towards integrating jobs under pipelines in For Current Branch section of the sidebar and that's great!...not sure if that work/code transferred over with the project ownership shift. I'm not sure if the intent was clicking one of those jobs would have opened the build output?...that's what I would love to see!

### Links / references


</details>",2
74267730,2020-11-12 16:05:07.992,MR Review: Show comments on changed file diff,"### Problem to solve

Users who perform MR review in VS Code can get additional context from commetns that are placed directly on the diff.

### Proposal

![_Extension_Development_Host__-_test_js__MR____test-project](/uploads/53a54bf961c2845edf5d527771348e5a/_Extension_Development_Host__-_test_js__MR____test-project.png)

We are going to fetch all comments for the MR and show the non-outdated on the diff.

### Further details

This issue is described in a detail on the POC work here: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/243#showing-existing-comments

### Out of scope

- adding, editing or deleting comments
- reactions

### Links / references",2
74267126,2020-11-12 15:54:10.556,MR Review: Show changed file diff (Git-provided),"### Problem to solve

After implementing https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/264, user can see change diff for an MR file, but the change needs to be fetched from the GitLab API, putting additional load on the API but mainly decreasing the responsivness of the review. Often the file is going to be already present in the local Git repo and that's where we'll try to get it from.

### Proposal

Implement a content provider that will be able to serve file content for a specific version. It will serve this content from the local git repository.

### Further details

Showing the diff is explained in the [MR Review POC](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/243#file-diff-view). When we are done, we'll have a chain of content providers as shown in:

```mermaid
graph LR
A[VS Code] -- ""gl-review: URI"" --> B[LocalGitContentProvider]
B --> C[RemoteApiContentProvider]
```

This issue implements the `LocalGitContentProvider`

Good way to approach this is going to be to use the native Git extension that is always present as a part of VS Code. That way we'll have all git-related information in VS Code in sync. Eventually we might want to move away from executing the git command ourselves in other parts of the codebase as well.

### Links / references

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/243",3
74266031,2020-11-12 15:36:33.210,MR Review: Show changed file diff (API-provided),"### Problem to solve

When reviewing MRs, users need to see changed files. This is going to be the first iteration of showing users the changes made in the file.

### Proposal

![Extension\_Development\_Host\_-\_terraform\_list\_vue\_\_MR\_\_\_\_gitlab\_and\_Add\_\_Ability\_to\_chec\_\_\_\_\_\_gitlab-vscode-extension\_and\_zsh](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/8731b1c3adb85de00977d0a4edbfdeb5/_Extension_Development_Host__-_terraform_list_vue__MR____gitlab_and_Add__Ability_to_chec______gitlab-vscode-extension_and_zsh.png)

Once the user clicks on a changed file (see https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/263), VS Code will open a file diff showing the change. VS Code will get file content from the GitLab instance API.

### Further details

Showing the diff is explained in the [MR Review POC](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/243#file-diff-view). When we are done, we'll have a chain of content providers as shown in:


```mermaid
graph LR
A[VS Code] -- ""gl-review: URI"" --> B[LocalGitContentProvider]
B --> C[RemoteApiContentProvider]
```

This issue is going to implement the remote content provider. We'll start with the remote provider in the first iteration because the remote provider will always have the content and the local git provider is optimisation that we'll implement next.

Showing diff for images and other binaries is out of scope.

We need to have a look into how to show diffs of extra large text files like `package-lock.json`.

### Links / references",2
74265459,2020-11-12 15:24:48.558,MR Review: Show changed files for the MR,"### Problem to solve

As a part of MR review, users need to see what files changed. It's the initial step in selecting a chagned file and inspecting the MR diff view.

### Proposal

![_Extension_Development_Host__-_agents_spec_js___gitlab](/uploads/411e83788322641d0258bdf50b2ad547/_Extension_Development_Host__-_agents_spec_js___gitlab.png)

Building on top of the work in https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/243 we would extend the MR items in the tree view as per the screenshot. For each MR user can click on the MR and see an item representing the description and all changed files.

### Further details

- We would have a chance to deside what icons do we want to show and we could also redesign the tree structure (e.g. grouping issue queries and MR queries)
- The current implementation of the tree view is mainly untested (except for a few integration tests) and it is not extensible in its current form. We will need to refactor the tree view a bit before we can start building on top of it.


### Links / references",2
73785128,2020-11-03 09:45:30.677,"Consistent handling of remotes, instances and branches","### Problem to solve

With the implementation of https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/90 we started discovering several classes of errors related to parsing information about the workspace git repository.

The main issue is the complex edge cases that were never considered (sorted by how frequently they occur):

- Mutiple remotes in one repository
  - here we can get a remote that is not matching the defined `instanceUrl` (more details: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/115#note_410341027)
- Multi-root workspaces
  - Which remote, `instanceUrl` and branch to use when there are multiple git repositories in one workspace?
  - currently, we use the open file to find out what git repository should we use, but if there's no file open we have very inconsistent handling
- Tracking branches
  - sometimes we ask for [tracking branch](https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches#_tracking_branches) which can again point to a different remote than what we use for rest of the requests

### Proposal

Separate the current `GitService` into three modules with different responsibilities:

- thin layer on top of the `git` shell command
- instanceUrl service that would be responsible for matching git remotes and define tokens
- GitLab-specific git logic (e.g. picking which remote to use based on an instanceUrl, creating GitLab API URL based on git remote)

The last service would return an object with the following attributes:

- `apiUrl` - where to send API requests
- `namespace` - group or username
- `project` - project name
- `branch` (optional) - remote branch (e.g. to query for active pipelines)


### Further details

The main benefit of the proposed solution is that we would have certainty that our `instanceUrl` matches the `namespace`, `project`, and `branch` information. This would reduce hard to remove issues and it would improve the environment for contributors because the current edge-case ridden code is very hard to understand.

We also have two config options that override the aforementioned logic:

```json
""gitlab.remoteName"": {
  ""type"": ""string"",
  ""default"": null,
  ""description"": ""Name of the git remote to use in order to locate the Gitlab project""
},
""gitlab.pipelineGitRemoteName"": {
  ""type"": ""string"",
  ""default"": null,
  ""description"": ""Name of the git remote to use in order to locate the Gitlab project for your pipeline. Keep empty for default""
},
```

### Links / references

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/34
- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/71",3
73753976,2020-11-02 18:26:09.487,403 Forbidden Error on Projects with Pipelines Disabled,"### Summary

When configuring the Gitlab Workflow Plugin with a repo that has Pipelines Disabled, the extension tosses a 403 when viewing Merge Requests. Enabling Pipelines allows Merge Requests to once again be polled and return results as expected. Gitlab in this bug report is self-hosted v13.4.2-ee and not on Gitlab.com (not sure if that matters).

### Steps to reproduce

*Note: this happens on `gitlab.com` as well.*

1. Setup on-prem (non-gitlab.com) personal access token
2. Setup Settings to use the proper Gitlab Instance URL (gitlab.examplecompany.com)
3. Find/Create a repository with Merge Requests Enabled and Pipelines Disabled.
    ![General___Settings___Tomas_Vik___test_project___GitLab](/uploads/425b823650eb8e1842a0a89269d10709/General___Settings___Tomas_Vik___test_project___GitLab.png)
4. Attempt to use the VSCode Plugin to view MRs but receive a 403
    ![Screenshot_2020-11-04_at_2.14.00_PM](/uploads/afadc494c8f938192e0af93ed6d59d62/Screenshot_2020-11-04_at_2.14.00_PM.png)

### What is the current *bug* behavior?

403 - Forbidden

### What is the expected *correct* behavior?

Ability to see Active/Closed MRs, or MRs assigned to ""me""

### Relevant logs and/or screenshots

```
403 - ""{\""message\"":\""403 Forbidden\""}""
StatusCodeError: 403 - ""{\""message\"":\""403 Forbidden\""}""
	at new StatusCodeError (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/request-promise-core/lib/errors.js:32:15)
	at /Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/request-promise-core/lib/plumbing.js:97:41
	at tryCatcher (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/util.js:16:23)
	at Promise._settlePromiseFromHandler (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/promise.js:547:31)
	at Promise._settlePromise (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/promise.js:604:18)
	at Promise._settlePromiseCtx (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/promise.js:641:10)
	at _drainQueueStep (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/async.js:97:12)
	at _drainQueue (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/async.js:86:9)
	at Async._drainQueues (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/async.js:102:5)
	at Immediate.Async.drainQueues [as _onImmediate] (/Users/joel.vasallo/.vscode/extensions/gitlab.gitlab-workflow-3.6.0/node_modules/bluebird/js/release/async.js:15:14)
	at processImmediate (internal/timers.js:439:21)
```

### Possible fixes

The fix for now is to enable Pipelines in the project settings.

The [offending code in `current_branch.js`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/blob/a03468d9e525fa9c9835fa8466e48646b8369f18/src/data_providers/current_branch.js#L101-103):

```js
  async getChildren() {
    try {
      const workspaceFolder = await getCurrentWorkspaceFolder();
      this.project = await gitLabService.fetchCurrentProject(workspaceFolder);
      await this.fetchPipeline(workspaceFolder);
      await this.fetchMR(workspaceFolder);
      await this.fetchClosingIssue(workspaceFolder);
    } catch (e) {
      handleError(e);
      this.children.push(new ErrorItem());
    }

    return this.children;
  }
```

Since the fetching pipeline fails, the whole request fail. This code didn't consider that some of the calls could be still successful.",1
73586084,2020-10-29 15:41:41.379,Collecting MAU for GitLab Workflow (VS Code) Extension,"## Problem to Solve

The GitLab Workflow Extension is currently used outside of the main GitLab application and connects to GitLab instances via API to perform tasks. There is currently no standard way within GitLab to understand this usage and provide accurate usage statistics to aid in feature development, prioritization and continued investment in the extension.

## Additional Details

GitLab has a series of [performance indicators](https://about.gitlab.com/handbook/product/performance-indicators/#structure) based around AMU (Active Monthly Users). In many cases these are measured as aggregate counts of users who engage with certain features over a period of time. An example of this is for the ~""group::editor"" [`Git write operations from web editors`](https://about.gitlab.com/handbook/product/dev-section-performance-indicators/#createeditor---gmau---mau-conducting-git-write-operations-from-web-editors) are measured.

## Proposal

Intercept some hook for all API calls or develop/use a rack middleware. This way we could log usage in Redis using Product Analytics HLL (distinct counts) or regular count APIs.

<details><summary>Old Proposal</summary>

### Option 1

With the release of GitLab Workflow 3.6.0 a [User-Agent is included in all API requests](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/238) that identifies the extension and the version. If log collection and importing of specific data was available in the Data Warehouse ([other](https://gitlab.com/gitlab-data/analytics/-/issues/5305) [proposals](https://gitlab.com/gitlab-data/analytics/-/issues/5200) suggesting log usage) we could aggregate logs based on this user agent. We would need some way to get additional data to identify users in aggregate and not specifically, but this could be a foundation for getting usage numbers.

### Option 2

In an effort to [improve the onboarding flow](https://gitlab.com/groups/gitlab-org/-/epics/4363) a proposal is being considered to [implement OAuth](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/221) for using the extension. OAuth applications are [stored in the database](https://gitlab.com/gitlab-org/gitlab/-/blob/master/db/structure.sql#L13981) of GitLab which would allow us to count the number of authorizations. **Lacking from this could be last used as that doesn't appear to be tracked.**

Also important is that the level of effort required for Option 2 might be [quite significant](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/221#note_438407317) and is not the preferred path at this time.

</details>",3
73185897,2020-10-22 17:16:52.757,Can't respond in comment thread in webview for MR/Issue,"## Problem to solve

Inside of Issues and Merge Requests you can comment in a new comment or via a threaded reply to a parent comment. The option to reply in a thread to a parent comment is not available inside of the webview for issues/merge requests.

![Screen_Shot_2020-10-22_at_12.13.09_PM](/uploads/6b7d158f17d3e5222e38ecc06f18c0be/Screen_Shot_2020-10-22_at_12.13.09_PM.png)

## Proposal

The ability to respond via a threaded reply should be added so that conversations can be properly tracked and resolved.",2
72274320,2020-10-06 18:05:02.340,Create POC for MR review feature,"### Problem to solve

Before we implement #53, we'd like to validate certain assumptions like:

- GitLab API provides us with the MR diff file content and comments in an easy-to-consume format
- VS Code Extension API allows for easy integration of the GitLab API results with the diff view

### Proposal

Implement POC that can:

1. Show files that have been changed in the MR
1. For each one of those files shows a diff view between merge-base and the MR branch
1. Display comments from the MR diff
1. Allow creating comments on the diff

# Report from POC implementation

This report is a summary of the POC work. It will try to explain what uncertainties we've removed and discovered.

![_Extension_Development_Host__-_test_js__MR____test-project_and_mr_item_js___gitlab-vscode-extension_and_zsh](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/e641142e889443c1118f8a5ab49a0f92/_Extension_Development_Host__-_test_js__MR____test-project_and_mr_item_js___gitlab-vscode-extension_and_zsh.png)

## Try it yourself

Straight to the fun bit, try it yourself by installing the [packaged extension with POC](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/raw/mr-review-poc/gitlab-workflow-3.6.0.vsix?inline=false) ([how to install](https://stackoverflow.com/questions/37071388/how-can-i-install-visual-studio-code-extensions-offline))

**Caveat: All MR refs (commits) need to be available locally (run `git pull` before trying the POC)**

I've tested the POC on `gitlab-org/gitlab` project and it seemed to work for most of the MR's.

The messy code is available in [`mr-review-poc` branch](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/tree/mr-review-poc).

## Features:

### File tree:

![_Extension_Development_Host__-_index_md___gitlab](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/7dc75673aba70492f162abc2f095bf00/_Extension_Development_Host__-_index_md___gitlab.png)

#### Certainty overview

- Dependencies available and working: **4/5**
  - REST API ✅, GraphQL ❌
- VS Code API suits our needs: **4.5/5**
  - Only the Git Changed status indicator is unavailable to us.
- The codebase is ready for implementation: **3/5**
  - Tree view cleanup necessary before starting

#### Details

There is no custom UI involved; we are going to utilise the VS Code API.

We can get necessary information about the changed files from the REST API ([MR version](https://docs.gitlab.com/ee/api/merge_requests.html#get-a-single-mr-diff-version)). The GraphQL API can't provide us with the necessary information (https://gitlab.com/gitlab-org/gitlab/-/issues/280803).

Creating the file tree seems straight forward, the only thing I wasn't able to achieve vas to show the Git Changed status indicator:

![_Extension_Development_Host__-_snippet_blob_actions_edit_vue___gitlab](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/3637bb847c89d94b70cc4157bdf9c3b7/_Extension_Development_Host__-_snippet_blob_actions_edit_vue___gitlab.png)

The API seems not to be officially exposed.

When talking about the design, we'll have to decide between two ways of showing the changes:

| Tree | Path in the item detail |
| ------ | ------ |
| ![constants_ts___gitlab-vscode-extension](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/bc8cbe08ad4bc90054dca50a6ce9a525/constants_ts___gitlab-vscode-extension.png) | ![constants_ts___gitlab-vscode-extension](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/436d38db17c1a2d0d980c53a9eaabc43/constants_ts___gitlab-vscode-extension.png) |

#### Known issues and uncertainty

- The current code ([issuable.js](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/src/data_providers/issuable.js) and [sidebar\_tree\_item.js](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/src/data_providers/sidebar_tree_item.js) will need a cleanup before we can start build on topo of it.
- We'll probably always work with the last MR version and will ignore the intermediate versions.
- We might want to start showing Merge Requests differently from issues in the Tree View. Also we might want to choose icons for all tree items.

### File Diff View

![_Extension_Development_Host__-_terraform_list_vue__MR____gitlab_and_Add__Ability_to_chec______gitlab-vscode-extension_and_zsh](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/8731b1c3adb85de00977d0a4edbfdeb5/_Extension_Development_Host__-_terraform_list_vue__MR____gitlab_and_Add__Ability_to_chec______gitlab-vscode-extension_and_zsh.png)

#### Certainty overview

- Dependencies available and working: **3/5**
  - fetching remote content has not been tested
- VS Code API suits our needs: **5/5**
- The codebase is ready for implementation: **2/5**
  - It would be best to slowly shift Git related responsibility to VS Code (instead of running shell command)

#### Details

VS Code provides us with the diff functionality, the only thing we do is defining a custom document URI and then implement content providers for that URI.

Uri:

```
""gl-review://authority/app/assets/javascripts/terraform/graphql/queries/get_states.query.graphql?commit%3D5fa9332d0cedb98b0095b34d01470e419d3a98ba%26workspace%3D%2FUsers%2Ftomas%2Fworkspace%2Fgitlab%2Fgitlab-development-kit%2Fgitlab%26version%3Dbase""
```

When VS Code tries to open our URI, it will invoke our content provider, which returns a `string` content of the file. The POC implements only the local git content provider, which means that the file version (correct commit) needs to be in the local git repository. The proper implementation is going to implement a fallback provider which will fetch the content from the API.

```mermaid
graph LR
A[VS Code] -- ""gl-review: URI"" --> B[LocalGitContentProvider]
B --> C[RemoteApiContentProvider]
```

The future-proof way to interact with `git` is to use the VS Code core extension for Git (originally suggested in !54). It is how most of git-related extensions work. The added benefit is that everything git related (VS Code VCS view, other extensions, our extension) is going to be in sync. This will require a bit of plumbing implementation, potentially overlapping with [Consistent handling of remotes, instances and branches](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/260).

#### Known issues and uncertainty

- I haven't implemented the API file content provider and so we don't have 100% certainty that we can retrieve the content.
- I'm not sure how are we going to react to remote changes. For example, when the user refreshes the file tree and all of a sudden the displayed diff doesn't correspond with the latest version.
- I'm not sure if there is a difference in how we'll use API to fetch file content from forked projects
- **Images** - VS Code can show images in tabs, but the POC haven't done any exploration of how that works.

### Showing existing comments

![_Extension_Development_Host__-_test_js__MR____test-project](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/53a54bf961c2845edf5d527771348e5a/_Extension_Development_Host__-_test_js__MR____test-project.png)

#### Certainty overview

- Dependencies available and working: **5/5**
- VS Code API suits our needs: **4/5**
  - GitLab-specific highlighting like #243, !54 and @viktomas is not going to work
  - images and advanced Markdown syntax (mermaidjs) is not working out of the box and maybe not at all
- The codebase is ready for implementation: **5/5**
  - This is going to be a greenfield development.

#### Details

This feature is going to use GraphQL, so far it seems to be the only endpoint that's going to work out of the box.

<details>
<summary>See the full GrapQL query</summary>

```graphql
 query GetDiscussions($projectPath: ID!, $iid: String!) {
    project(fullPath: $projectPath) {
      mergeRequest(iid: $iid) {
        discussions {
          nodes {
            notes {
              nodes {
                body
                author {
                  name
                  avatarUrl
                }
                position {
                  diffRefs {
                    baseSha
                    headSha
                  }
                  filePath
                  positionType
                  newLine
                  oldLine
                  newPath
                  oldPath
                }
              }
            }
          }
        }
      }
    }
  }
```

</details>

The VS Code API allows us to add comments for our custom URI. This seems to work really well (and potentially handles automatically comments on outdated diffs). Each comment has a `body` (markdown string) and Author information. We create the commits as follows:

```js
commentController.createCommentThread(
  getReviewUri({
    path,
    commit,
    workspace: this.projectUri,
    version: old ? 'base' : 'head',
  }),
  new vscode.Range(vsPosition, vsPosition),
  comments,
);
```

#### Known issues and uncertainty

- **I assumed the following about the GrapQL response**
  - Each GitLab comment has a `diffRefs` and I assume they always point to the latest MR version (even if the comment was made on the previous version).
- The POC didn't validate editing or deleting existing comments. 
- Reactions to the comments are possible but weren't part of the POC.
- As mentioned in the ""Certainty overview"", some markdown might be not rendering correctly
- The comments can range over multiple files (according to the API) but it hasn't been tested

### ⚠️Creating new review comments⚠️

![pullRequestNode_ts__Pull_Request____vscode-pull-request-github](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/d9dcfad2c415cfd1e651592733fbd400/pullRequestNode_ts__Pull_Request____vscode-pull-request-github.png)

#### Certainty overview

- Dependencies available and working: **1/5**
  - I wasn't able to reliably create a comment (note) on GitLab MR through our API.
- VS Code API suits our needs: **3/5**
  - It should because other extensions work, but parts of the API are not officially documented.
- The codebase is ready for implementation: **5/5**
  - This is going to be a greenfield development.

#### Details

First, we tell the VS Code where in the file can we create comments. VS Code provides an API for that: [CommentingRangeProvider](https://code.visualstudio.com/api/references/vscode-api#CommentingRangeProvider). This provider gets a URI and returns ranges of lines where it is possible to comment.

My understanding is that on an MR Diff, we can comment on any (even not changed) line in the left-hand side of the diff and only on changed lines in the right-hand side:

![Update_test_js_take_2___2____Merge_Requests___Tomas_Vik___test_project___GitLab](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/5872be9dc8cd3e79bfa6b32adc34ffc7/Update_test_js_take_2___2____Merge_Requests___Tomas_Vik___test_project___GitLab.png)

When we have the commenting ranges, the user can click on the commenting gutter and start a comment:

![_Extension_Development_Host__-_test_js__MR____test-project](https://gitlab.com/gitlab-org/gitlab-vscode-extension/uploads/3cb38bd8a5b1a7ac572c22b4a562d38d/_Extension_Development_Host__-_test_js__MR____test-project.png)

The buttons on the comment are custom defined and can have arbitrary functionality (Comment now, Add to review). This configuration is done in [package.json](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/mr-review-poc/package.json#L142) and **it is not officially documented**.

#### GitLab API problem

We are not dogfooding our REST or GraphQL APIs for our code review on GitLab website. I wasn't able to create a new comment through our API in two days. Partly because I'm unfamiliar with the domain and partly because the documentation is quite brief. I faced several bugs (https://gitlab.com/gitlab-org/gitlab/-/issues/281143 and one similar to https://gitlab.com/gitlab-org/gitlab/-/issues/37066) that I need to debug further before I can report them.

Without further investigation, I can't tell whether there is a way of implementing creating comments from VS Code or whether we need to implement/update/fix API endpoints first.

#### Known issues and uncertainty

- The POC didn't implement adding comments and so there is large uncertainty.
- I'm also not familiar with the MR Review workflows to be able to foresee any edge cases.
- Large part of the comment functionality is undocumented and we might result in using [vscode-pull-request-github](https://github.com/microsoft/vscode-pull-request-github) as documentation (it's good that it is under MIT license).

### Local git manipulation (e.g. Check out MR branch)

I wasn't able to include this in POC.
<!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION -->
*This page may contain information related to upcoming products, features and functionality.
It is important to note that the information presented is for informational purposes only, so please do not rely on the information for purchasing or planning purposes.
Just like with all projects, the items mentioned on the page are subject to change or delay, and the development, release, and timing of any products, features, or functionality remain at the sole discretion of GitLab Inc.*
<!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION -->",3
72030889,2020-10-01 16:41:36.586,"The ""Select a Gitlab Project"" dialog gets stuck in a perpetual loop","### Summary

I have a workspace with three GitLab projects in it. Sometimes when using the ""Create a new merge request..."" action, it stalls for a few seconds and then the ""Select a Gitlab Project"" dialog opens, but no amount of interacting with the dialog will get it to go away and complete the action.

* MacOS 10.15.6
* VSCode 1.49.2
* GL extension: 3.3.0
* GL host/plan: Ultimate

### Steps to reproduce

1. Open a [Multi-root workspace](https://code.visualstudio.com/docs/editor/multi-root-workspaces)
1. Open a non-project editor tab (easiest might be to open any extension page from the extension side panel, @joel.schou recommends diff view)
1. Use the keyboard command to open the Command Palette
1. Find ""GitLab: Create new merge request on current project"" and hit Enter
1. Wait for the ""Select a Gitlab Project"" dialog
1. Choose a project

<details>
<summary>Original steps</summary>

1. Add at least two projects to a single workspace
1. Make changes in one and commit the files locally, then push your branch up
1. Have a file open in the DIFF view 👈 **Edit: this might be the key**
1. Use the keyboard command to open the Command Palette
1. Find ""Create a new merge request..."" and hit Enter
1. Wait for the ""Select a Gitlab Project"" dialog
1. Choose a project

</details>

This doesn't happen every time I use ""Create a new merge request..."". Sometimes the extension makes a wise guess at the project I want it to choose and opens the new MR screen in GitLab. Other times the dialog comes up immediately and I can successfully choose the project. In the past couple days, though, I've been stuck in this loop.

### What is the current *bug* behavior?

The extension stops working. After some time the ""Select a Gitlab Project"" dialog will show and it will not go away for good. Trying to escape from it or select a project on it simply closes it and then brings it back.

### What is the expected *correct* behavior?

I should be able to use the dialog as normal.

### Relevant logs and/or screenshots

I cannot get at the logs because any time the dialog loses focus, it closes and immediately opens again, stealing focus.

![Kapture_2020-10-05_at_11.47.33](/uploads/74a4a88808631a4166ac4f4d9f1a1f00/Kapture_2020-10-05_at_11.47.33.gif)

<details>
<summary>Logs</summary>

```
Command failed with exit code 128: git ls-remote --get-url
fatal: No remote configured to list refs from.
Error: Command failed with exit code 128: git ls-remote --get-url
fatal: No remote configured to list refs from.
	at makeError (/Users/tomas/workspace/code/gitlab-vscode-extension/node_modules/execa/lib/error.js:59:11)
	at handlePromise (/Users/tomas/workspace/code/gitlab-vscode-extension/node_modules/execa/index.js:114:26)
	at runMicrotasks (<anonymous>)
	at processTicksAndRejections (internal/process/task_queues.js:94:5)
	at async GitService._fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:31:26)
	at async GitService._fetchRemoteUrl (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:51:21)
	at async GitService.fetchGitRemote (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:65:12)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:160:20)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 2)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async Object.getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async openCreateNewMr (/Users/tomas/workspace/code/gitlab-vscode-extension/src/openers.js:112:27)
	at async /Users/tomas/workspace/code/gitlab-vscode-extension/src/extension.js:29:5
Command failed with exit code 128: git ls-remote --get-url
fatal: No remote configured to list refs from.
Error: Command failed with exit code 128: git ls-remote --get-url
fatal: No remote configured to list refs from.
	at makeError (/Users/tomas/workspace/code/gitlab-vscode-extension/node_modules/execa/lib/error.js:59:11)
	at handlePromise (/Users/tomas/workspace/code/gitlab-vscode-extension/node_modules/execa/index.js:114:26)
	at runMicrotasks (<anonymous>)
	at processTicksAndRejections (internal/process/task_queues.js:94:5)
	at async GitService._fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:31:26)
	at async GitService._fetchRemoteUrl (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:51:21)
	at async GitService.fetchGitRemote (/Users/tomas/workspace/code/gitlab-vscode-extension/src/git_service.js:65:12)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:160:20)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async fetch (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:63:5)
	at async fetchProjectData (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:148:28)
	at async fetchCurrentProject (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:162:12)
	at async Promise.all (index 1)
	at async Object.getAllGitlabProjects (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:228:20)
	at async Object.showPicker [as show] (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_project_input.js:5:34)
	at async Object.getCurrentWorkspaceFolderOrSelectOne (/Users/tomas/workspace/code/gitlab-vscode-extension/src/gitlab_service.js:52:23)
	at async openCreateNewMr (/Users/tomas/workspace/code/gitlab-vscode-extension/src/openers.js:112:27)
	at async /Users/tomas/workspace/code/gitlab-vscode-extension/src/extension.js:29:5
```

</details>

### Possible fixes

 ¯\＿(ツ)＿/¯

- Break the circular dependency between `gitlabProjectInput.show()` and `gitlab_service`.

### Workaround

- Always have a project file open in the editor when running GitLab Workflow commands.
- The best option for using multi-root workspaces might be downgrading to [`3.2.1`](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/main/CHANGELOG.md#321-2020-08-31) (previous version) until a fix is released.

![Screenshot_2020-10-05_at_12.10.07_PM](/uploads/e1ab63715c1ab173440b174fd320102c/Screenshot_2020-10-05_at_12.10.07_PM.png)",2
71639849,2020-09-24 15:48:54.308,Include User-Agent to all API requests,"### Problem to solve

We don't know how many of our users are using the extension and we managed to push some extension changes in the past that started hitting GitLab.com API hard (https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/211)

### Proposal

Include [User-Agent header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent) to all API requests made by the extension. This way we'll be able to see how many requests are coming from the extension.

```User-Agent: vs-code-gitlab-workflow/${packageJson.version}```

### Further details

<!-- Include examples, use cases, benefits, goals, or any other details that will help us understand the problem better. -->

### Links / references

For GitLab team members, the access logs can be seen in https://log.gprd.gitlab.net/app/kibana",1
70316834,2020-08-26 11:45:34.784,Detached Pipeline Status,"### Problem to solve
As a developer in a company that uses only [Pipelines for Merge Requests](https://docs.gitlab.com/ee/ci/merge_request_pipelines/), I would still like to be able to see the status of my current pipeline in VSCode. Currently, it always reports ""No pipeline found"", because there is no pipeline associated with the branch. Only with the Merge Request.


### Proposal
If a related merge request is detected, try fetching the status of the Merge Request Pipeline first, and if that does not exist fall back to fetching the pipeline for the branch.

Maybe add a config option to toggle this behavior on/off

### Further details
n/a

### Links / references

- [REST API docs](https://docs.gitlab.com/ee/api/merge_requests.html#list-mr-pipelines)",2
69366225,2020-08-03 13:38:31.751,Improve onboarding by enabling users to get started via OAuth,"### Problem to solve
Right now a user has to set his personal access token (PAT) to login to the GitLab instance. So the user needs to go to the instance, go through the settings, grab the token, go back to VSCode and paste the token and hopefully it works. This works but the workflow could be much better here.

### Proposal
After trigger the GitLab login command in VSCode
1. the user get asked for the GitLab instance url
2. the browser popup with a tab with the ""authorize"" application for ... 
3. user get some kind of popup that login was successful

This would make it also easier to setup multiple GitLab instances.

### Links / references

- Documentation [GitLab as an OAuth2 provider](https://docs.gitlab.com/ee/api/oauth2.html#gitlab-as-an-oauth2-provider)
- [Discussion: Streamlined GitHub authentication · Issue #93 · microsoft/vscode-pull-request-github](https://github.com/microsoft/vscode-pull-request-github/issues/93)

#### Example of GitHub extension authentication

![Kapture_2020-08-04_at_13.50.59](/uploads/d5b71ee72819ca6748fc6a74a5215c97/Kapture_2020-08-04_at_13.50.59.gif)",2
69354629,2020-08-03 08:49:28.238,TS migration 2: migrate gitlab_service,"### Problem to solve

This is a followup issue for #219. `gitlab_service.js` has got 670 LOC and because we need to convert a JS file to TS in one go, we are creating a separate issue just for this conversion. The rest of the extension will be converted in the spirit ""you touch it, you convert it"".

### Proposal

We are going to migrate the `gitlab_servic.js` to TypeScript. This service is providing the rest of the extension with information from the GitLab instance.

```mermaid
graph TD
A[rest of the extension] --> B
D[status_bar] -->
B[gitlab_service] -->
C[git_service.ts]
B --> D
```

### Further details

#### In scope

- break the cyclic dependency so that `gitlab_service` isn't dependent on `status_bar`
- write 3 - 5 integration tests touching the GitLab service
- define types for `token_service` and `gitlab_project_input` (or migrate them to TS if it's trivial)
- rewrite the `gitlab_service.js` to TypeScript
- manual testing afterwards

#### Out of scope

- rewriting any other code to TypeScript
- extensive test coverage with unit test (would take too long)
- redesigning the `gitlab_service.js` (for easy review, the code branches and interfaces shouldn't change too much)

### Links / references

- original decision to split the work this way: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/204#note_388292319
- example of the rewrite can be found in !53",2
69354151,2020-08-03 08:36:35.710,TS migration 1: configure TS and migrate git_service,"### Problem to solve

We decided to proceed with migrating the small codebase of this extension to TypeScript #204. We are going migrate the extension iteratively. This is the first step.

### Proposal

We are going to migrate the `git_service.js` to typescript. This service is providing the extension with information about the project git repository (branches, remotes ..). The rest of the extension is dependent on this service and we can start immediately benefit from using autocomplete in code dependent on git.

```mermaid
graph TD
A[rest of the extension] -->
B[gitlab_service] -->
C[git_service]
A --> C
```

### Further details

#### In scope

- write integration tests touching the git service - namely, test functionality that uses:
    - branch name
    - tracking branch name
    - current commit SHA
    - remote repository URL
- configure TypeScript compilation in a way that it works with the rest of the extension which is still in JavaScript
- configure TypeScript linting and prettier
- rewrite the `git_service.js` to TypeScript
- introduce static `create()` method as described in https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/merge_requests/100#note_414925480
- manual testing afterwards

#### Out of scope

- rewriting any other code to TypeScript
- extensive test coverage with unit test (would take too long)
- redesigning the `git_service.js` (for easy review, the code branches and interfaces shouldn't change too much)

### Links / references

- original decision to split the work this way: https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/204#note_388292319
- example of the TS configuration and rewrite can be found in !53",3
55905406,2020-07-13 20:11:46.925,webview: extension sometimes posts same comment multiple times,"### Summary

Sometimes the extension sends the same entered message multiple times to the opened issue/MR when using the experimental webview.

### Steps to reproduce

Note that in my experience this seems to be inconsistent.

1. Enable Experimental Features in Extension Settings (gitlab.enableExperimentalFeatures)
1. Open an issue in webview
1. Send a comment

I should note that I have had more success getting this to happen when multiple webview-tabs are open simultaneously (I tested with two), though I had this happen even with only one webview tab open. Perhaps other tabs (like open files) also cause this or maybe doing the multiple tabs aren't strictly required for the bug to occur.

The first time I encountered this behaviour was before GitLab officially adopted this extension, so it isn't a recent development.

### What is the current *bug* behavior?

The same message is sent to the same issue multiple times instead of once. Quick actions seem to be applied multiple times, too.

### What is the expected *correct* behavior?

The new comment and any included quick action should only be added/triggered once.

### Relevant logs and/or screenshots

![GitLab_Workflow_Message_duplication_glitch](/uploads/4f0c7cd0d1fbf3a8d1feffaf3d51b78d/GitLab_Workflow_Message_duplication_glitch.gif)

### Possible fixes

No idea.

### Versions and OS
* VSCode Version: 1.47.0 (commit d5e9aa0227e057a60c82568bf31c04730dc15dcd)
* Extension Version: 3.0.4 (from official marketplace)
* OS: Arch Linux x86_64 (all packages up-to-date)",2
55518070,2020-07-13 12:59:09.656,Change the default branch from `master` to `main`,"In order to support the discussion and our initiative of changing the default branch name, we should follow this [GitLab Issue](https://gitlab.com/gitlab-org/gitlab/-/issues/221164) 

Let's rename `master` to `main`

- [x] Make sure any branch name depending scripts are updated
- [x] Make sure there are no blockers to make this change
- [x] Change the contribution guidelines to reflect the non-standard default branch name
- [x] Set `main` as default branch
- [x] change target branch of all open merge requests to `main`
- [x] unprotect `master`, delete it, and protect `master` branch again, allowing no one to create it
- [x] propagate the changes to the [security repo](https://gitlab.com/gitlab-org/security/gitlab-vscode-extension)

A similar project that just went through this change: https://gitlab.com/gitlab-org/gitlab-svgs/-/issues/127#note_378289361",1
53959952,2020-07-06 09:31:25.347,"""Validate GitLab CI config"" requires project for local file import","<!---
Please read this!

Before opening a new issue, make sure to search for keywords in the issues
filtered by the ""bug"" label:

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues?label_name%5B%5D=bug

and verify the issue you're about to submit isn't a duplicate.
--->

### Summary

""Validate GitLab CI config"" requires project for local file import. According to GitLab's online validator and documen tation this is incorrect

### Steps to reproduce

Create two file config in single repo. Open .gitlab-ci.yml and run ""GitLab: Validate GitLab CI config""

//.gitlab-ci.yml
```
stages:
    - echo

include:
    - local: child.gitlab-ci.yml
```

// child.gitlab-ci.yml
```
stages:
    - echo

echo:
    stage: echo
    image: ruby:2.6
    script:
        - echo ""echo""
```


### What is the current *bug* behavior?

Validation fails with error ""Local file `child.gitlab-ci.yml` does not have project!""

### What is the expected *correct* behavior?

Should say ""Your CI configuration is valid.""

### Relevant logs and/or screenshots

(Logs can be found by running `Developer: Show Logs ...` command (using `cmd+shift+p`) and selecting `Extension Host`)

### Possible fixes

(If you can, link to the line of code that might be responsible for the problem)",1
53883289,2020-07-03 13:02:09.783,Poll for branch information only in active window,"### Problem to solve

If the user opens multiple extension windows, all of those windows are going to be polling pipeline information (each 30s) and open MR and closing issue (each 60s) for the current branch. This could result in increased load on the API and issues like #211

### Proposal

The polling should only happen when the extension window is [`focused`](https://code.visualstudio.com/api/references/vscode-api#WindowState). Same way as the native `git` extension polls for remote branch changes.

We should also start to poll immediately after the window comes into focus ([`window.onDidChangeWindowState`](https://code.visualstudio.com/api/references/vscode-api#window.onDidChangeWindowState)).

### Further details

- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/ec80a6f81d5d9b5b402dcf8ad50f5ad45c21800b/src/status_bar.js#L121
- https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/ec80a6f81d5d9b5b402dcf8ad50f5ad45c21800b/src/status_bar.js#L184

### Links / references

I assume the official `git` extension implementation to be somewhere here https://github.com/microsoft/vscode/blob/master/extensions/git/src/statusbar.ts

The official VS Code extension API offers a [`WindowState`](https://code.visualstudio.com/api/references/vscode-api#WindowState) which allows us to find out whether the window is focused or not.",2
51409234,2020-06-29 10:34:46.691,Create a open-vsx account,"In order to be allowed to publish to https://open-vsx.org/ we need a token and a publisher account.
I would follow the same we use on the vscode marketplace.

- [x] Create a GitHub account for open-vsx with the `vscode@gitlab.com` email address
- [x] Create the `gitlab` publisher on open-vsx
- [x] Make sure login credentials are in the shared 1Password vault
- [x] Retrieve a token that can be used for publishing
- [x] Add the token to CI/CD configuration of [this project](https://gitlab.com/gitlab-org/gitlab-vscode-extension) as `OPENVSX_ACCESS_TOKEN` (same settings as `AZURE_ACCESS_TOKEN`)
- [x] Add the token to CI/CD configuration of the [security project](https://gitlab.com/gitlab-org/security/gitlab-vscode-extension) as `OPENVSX_ACCESS_TOKEN`
- [x] Claim the `GitLab` publisher namespace https://github.com/eclipse/open-vsx.org/issues/103

/cc @viktomas @phikai",1
50091981,2020-06-25 18:59:08.694,Publish GitLab Workflow extension to Open VSX Registry,"## Problem to Solve

Currently there are users who use VS Code alternatives like [VS Codium](https://github.com/VSCodium/vscodium), [Theia](https://theia-ide.org/) and others which are generally OSS alternatives to VS Code. In most cases, these editors are able to run VS Code extensions, but the VS Code marketplace is unavailable for normal distribution.

## Additional Details

[Open VSX](https://open-vsx.org) is an open-source registry for VS Code extensions. It can be used by any development environment that supports such extensions.

Additional information on how to publish an extension to Open VSX can be obtained [here](https://github.com/eclipse/openvsx/wiki/Publishing-Extensions).

## Proposal

In order to make the GitLab Workflow extension more accessible to more users we should also automate publishing of the extension to the Open VSX registry.

<details><summary>Original Description</summary>
I'm a [VS Codium](https://github.com/VSCodium/vscodium) user, a FLOSS version of VS Code. It's the same code but without Microsoft's telemetry, branding and licensing.

I would like to request, if possible, to add the **GitLab** extension to the [open-vsx.org](https://open-vsx.org) market as it is unclear if it's legal to use the official Microsoft extension marketplace on VS Code forks, see [here](https://github.com/microsoft/vscode/issues/31168).

Additional information on how to publish an extension to Open VSX can be obtained [here](https://github.com/eclipse/openvsx/wiki/Publishing-Extensions).
</details>",2
50023153,2020-06-24 10:19:41.127,Update contribution guidelines,"### Problem to solve

The contribution guidelines are not in line with GitLab standards.

### Proposal

- [x] Add DCO + License info at the top (see an example at https://gitlab.com/gitlab-org/gitlab-runner/-/blob/master/CONTRIBUTING.md)
- [x] Remove the separate [code of conduct file](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/master/CODE_OF_CONDUCT.md). Just have a link to the [Code of conduct page](https://about.gitlab.com/community/contribute/code-of-conduct/) as a SSOT in the [CONTRIBUTING.md](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/master/CONTRIBUTING.md) file
- [x] Remove ""Reporting Issues"" and ""Proposing Features"" sections and only point to the templates
- [x] Revisit the practical setup sections

### Further details

### Links / references",2
50018411,2020-06-24 09:09:48.936,Automated testing strategy,"### Problem to solve

There are no automated tests for the extension (with exception of [unit test for `parseGitRemote` function](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/master/test/unit_tests/git_service.test.ts)). We need to increase our automated test coverage to be able to make changes to the extension without introducing regressions.

### Proposal

Create a testing strategy for the extension.

*Personal opinion: At the beginning, we should focus on the highest level tests (integration/e2e). There is a lot of suggested work that is taking out major parts of the codebase (!53 !54 ). Unit tests written for these soon-to-be-replaced parts might not be the best use of our efforts*

### Acceptance criteria

- Testing pyramid for our VS Code Extension is described (i.e. what kind of tests we'll implement)
- Implement at least one example test for each level of testing (e.g. If we'll have unit tests, functional tests, and E2E tests, then at least one unit test, functional test, and E2E test).
- Example tests are reliably running in our CI

### Links / references

- My personal extension having [integration and unit tests](https://gitlab.com/viktomas/gitlab-example-extension/-/blob/integration-tests/.gitlab-ci.yml#L13-29)
- Testing guide in the official documentation https://code.visualstudio.com/api/working-with-extensions/testing-extension",3
50016385,2020-06-24 08:30:01.753,Automated CHANGELOG entries creation,"### Problem to solve

New entries are added to CHANGELOG ad-hoc, which results in more manual work and inconsistencies in the changelog entries.

### Proposal

Implement a mechanism similar to the one used `gitlab-org/gitlab` (https://docs.gitlab.com/ee/development/changelog.html). Each MR that introduces significant user-facing change would create a changelog entry. These entries would get compiled into a version changelog during the release of the new version.

Improving even further we could utilize the [releases](https://docs.gitlab.com/ee/user/project/releases/) feature which we've started using for GitLab. Example: https://gitlab.com/gitlab-org/gitlab/-/releases#v13.1.0-ee

### Links / references

- Example changelog entries: https://gitlab.com/gitlab-org/gitlab/tree/master/changelogs/unreleased/
- Ruby script for generating changelog entries: https://gitlab.com/gitlab-org/gitlab/-/blob/master/bin/changelog",2
34729493,2020-05-19 10:31:24.545,Deprecated dependency: request-promise,"In order to make requests towards GitLab `src/gitlab_service.js` makes use of 
the [`request-promise` library which is deprecated](https://github.com/request/request-promise#deprecated) since February 2020.

This dependency should be changed as it won't receive any security updates in the future. Note that !53 still seems to include this dependency.",2
34191828,2020-05-06 09:04:42.223,Opening the same MR or Issue in webview multiple times causes duplicated tabs,"I just noticed that when selecting an Issue or Merge Request I have already opened once, it opens another tab instead of showing the already existing tab.
This can cause the tab-bar to get full very quickly if you don't track what you already opened and is not how VSCode itself handles these things, so it's a bit annoying.

I know that the Issue and MR-Features are still experimental but wanted to point this strange behaviour out anyway.

* VSCode Version: 1.44.2 (ff915844119ce9485abfe8aa9076ec76b5300ddd)
* Extension version: 2.2.0
* OS: Arch Linux on 64bit Desktop-PC

## Screenshots

![Kapture_2020-06-29_at_10.06.24](/uploads/119fd679f949793d7ca7b4dfcc2d15d4/Kapture_2020-06-29_at_10.06.24.gif)

## Possible solution

If we use the VS Code native [Uri](https://code.visualstudio.com/api/references/vscode-api#Uri) to identify each issue and MR webview, we could avoid duplication without us writing any custom code.",2
30626235,2020-02-11 11:38:40.803,Click on merge request in status bar should open the webview,"Since one of the last versions, GitLab Workflow has this merge request detail view which opens when I click on a merge request from the list in the sidebar.

For user interaction consistency, I think this should also be the case when I click on the merge request link in the status bar.

*Note: the webview needs to be enabled as an [experimental feature](https://gitlab.com/gitlab-org/gitlab-vscode-extension#experimental-features).*

![Kapture_2020-06-25_at_11.10.06](/uploads/fb8ce39650c94975e314149b21f93f84/Kapture_2020-06-25_at_11.10.06.gif)


![image](/uploads/26516ec1c3bbac5070f5fedfbf156961/image.png)",1
30251516,2020-02-02 21:02:57.743,3.0.0 Release,"## Summary

Version `3.0.0` is the next major release of the extension. See details in the [CHANGELOG](https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/blob/master/CHANGELOG.md#v300-tbd).

## Testing strategy

- Testing new features of this release.
  - [x] Multi-root workspaces
    - VS Code documentation: https://code.visualstudio.com/docs/editor/multi-root-workspaces
    - Tested: tree view with issues, snippets, custom queries
  - [x] New icon (lines instead of fill)
  - [x] Custom queries
    - :question: The custom queries completely replace the default queries
    - works well even with multi-root workspaces
- Testing fixes in this release
  - [x] Creating snippets
  - [x] Improve remote URL parsing to support non-standard Gitlab usernames.
      - The implementatoin seems good to me. I don't have access to gitlab instance with different git user.
      - During testing weird names I discovered and fixed https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/197
  - [x] Click on merge request ""for current branch"" doesn't do anything
- [x] Sanity testing
  - this release introduces 16k changed lines of code, part of the testing should be generic happy-path testing of the extension's [Feature set](https://gitlab.com/gitlab-org/gitlab-vscode-extension#features).

<details>
<summary>Original descriptiom</summary>

Hi @fatihacet 

we should be ready for 3.0.0 release. Before go ahead with the release_checklist.md, would you mind to test the attached packaged extension to be sure we are not breaking anything?

Thank you

[gitlab-workflow-3.0.0.vsix](/uploads/2b7ef51cb938ff5bd0b3b7afcabb6855/gitlab-workflow-3.0.0.vsix)

</details>",4
